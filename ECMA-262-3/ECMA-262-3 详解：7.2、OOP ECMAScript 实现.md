ä»æ¥æ²¡æœ‰æ·±å…¥äº†è§£ECMAï¼Œç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œå‘ç°æ—©åœ¨2010å¹´å°±æœ‰å¤§ä½¬ [DmitryÂ Soshnikov](http://dmitrysoshnikov.com/about/) æ€»ç»“äº†ECMAä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ç¿»è¯‘è®°å½•ï¼ŒåŠ æ·±è‡ªå·±çš„å°è±¡ã€‚æ–‡ç« åŸæ–‡æ¥è‡ª [ECMA-262-3 in detail. Chapter 7.2. OOP: ECMAScript implementation.](http://dmitrysoshnikov.com/ecmascript/chapter-7-2-oop-ecmascript-implementation/)

# ä»‹ç»

è¿™æ˜¯ECMAScriptä¸­å…³äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ç¬¬äºŒéƒ¨åˆ†ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­æˆ‘ä»¬è®¨è®ºäº†ä¸€èˆ¬ç†è®ºï¼Œå¹¶ä¸ECMAScriptè¿›è¡Œäº†æ¯”è¾ƒã€‚åœ¨é˜…è¯»è¿™éƒ¨åˆ†å†…å®¹ä¹‹å‰ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®ä½ å…ˆè¯»ä¸€è¯»OOPçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä¼šç”¨åˆ°ç¬¬ä¸€éƒ¨åˆ†çš„æœ¯è¯­ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š[ECMA-262-3 è¯¦è§£ï¼š7.1ã€OOPä¸€èˆ¬ç†è®º](https://mp.weixin.qq.com/s/KNagxB2GlZxwejt3zBb7AA)

# ECMAScript OOP å®ç°

é€šè¿‡ä¸€èˆ¬ç†è®ºçš„é‡ç‚¹ä»‹ç»ä»¥åï¼Œç»ˆäºåˆ°äº†ECMAScriptè‡ªèº«ã€‚ç°åœ¨ï¼Œå½“æˆ‘ä»¬çŸ¥é“å…¶é¢å‘å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡è¿›è¡Œå‡†ç¡®çš„å®šä¹‰ï¼š

> ECMAScriptæ˜¯ä¸€ç§é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­è¨€ï¼Œæ”¯æŒåŸºäºåŸå‹çš„å§”æ‰˜ç»§æ‰¿ã€‚

æˆ‘ä»¬æ‰è€ƒè™‘æ•°æ®ç±»å‹å¼€å§‹åˆ†æã€‚é¦–å…ˆè¦æ³¨æ„åˆ°çš„å°±æ˜¯ECMAScriptåŒºåˆ†åŸå§‹å€¼ä¸å¯¹è±¡ä¸Šçš„å®ä½“ã€‚å› æ­¤æœ‰æ—¶åœ¨å„ç§æ–‡ç« ä¸­å‡ºç°çš„â€œJavaScriptä¸­ä¸‡ç‰©çš†å¯¹è±¡â€çš„ä¹ è¯­æ˜¯ä¸æ­£ç¡®çš„ï¼ˆä¸å®Œæ•´çš„ï¼‰ã€‚åŸå§‹å€¼æ¶‰åŠåˆ°æŸäº›ç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬è¯¦ç»†æ¥è®¨è®ºä¸€ä¸‹ã€‚

## æ•°æ®ç±»å‹

è™½ç„¶ECMAScriptæ˜¯ä¸€ä¸ªåŠ¨æ€çš„å¼±ç±»å‹è¯­è¨€ï¼Œå¸¦æœ‰[â€œé¸­å­â€ç±»å‹](https://zh.wikipedia.org/wiki/%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B)ï¼Œä»¥åŠè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œä½†å®ƒä»ç„¶å…·æœ‰æŸäº›æ•°æ®ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªå¯¹è±¡å±äºä¸€ç§å…·ä½“ç±»å‹ã€‚

æ ‡å‡†å®šä¹‰äº†9ä¸ªç±»å‹ï¼Œä½†æ˜¯åœ¨ECMAScriptè¿›ç¨‹ä¸­åªæœ‰6ä¸ªæ˜¯å¯ä»¥ç›´æ¥è®¿é—®çš„ï¼š

- Undefined
- Null
- Boolean
- String
- Number
- Object

ï¼ˆè¯‘è€…æ³¨ï¼šå½“å‰2020å¹´æ·»åŠ äº†Symbolä»¥åŠBigIntç±»å‹ï¼‰ã€‚

å…¶ä»–ä¸‰ä¸ªåªæœ‰åœ¨å®ç°çº§åˆ«å¯ä»¥è®¿é—®ï¼ˆECMAScriptå¯¹è±¡éƒ½ä¸å…·æœ‰è¿™ç§ç±»å‹ï¼‰ï¼Œå¹¶ç”±è§„èŒƒç”¨åŸŸè§£é‡ŠæŸäº›æ“ä½œè¡Œä¸ºï¼Œå­˜å‚¨ä¸­é—´å€¼ç­‰ã€‚å®ƒä»¬æ˜¯ï¼š

- Reference
- List
- Completion

å› æ­¤ï¼ˆç®€è¦æ¦‚è¿°ï¼‰, `Reference` ç±»å‹ç”¨äºè§£é‡Šè¯¸å¦‚ `delete` ï¼Œ `typeof` ï¼Œ `this` ç­‰ï¼Œå¹¶ä¸”ç”±åŸºç¡€å¯¹è±¡å’Œå±æ€§åæ„æˆã€‚ `List` ç±»å‹æè¿°å‚æ•°åˆ—è¡¨ï¼ˆåœ¨ `new` è¡¨è¾¾å¼ä»¥åŠå‡½æ•°è°ƒç”¨ä¸­ï¼‰çš„è¡¨ç°ã€‚åè¿‡æ¥ï¼Œ `Completion` ç±»å‹ç”¨åŸŸè§£é‡Š `break` ï¼Œ `continue` ï¼Œ `return` å’Œ `throw` è¯­å¥è¡Œä¸ºã€‚

å›åˆ°ECMAScriptç¨‹åºä¸­ä½¿ç”¨çš„6ä¸ªç±»å‹ï¼Œå‰é¢çš„5ä¸ªï¼š `Undefined` ï¼Œ `Null` ï¼Œ `Boolean` ï¼Œ `String` å’Œ `Number` æ˜¯åŸå§‹å€¼ç±»å‹ã€‚ï¼ˆè¯‘è€…æ³¨ï¼š `Symbol` å’Œ `BigInt` ä¹Ÿæ˜¯åŸå§‹å€¼ç±»å‹ï¼Œä¹Ÿå«åŸå§‹æ•°æ®ï¼‰ã€‚

åŸå§‹å€¼ğŸŒ°ï¼š

```jsx
var a = undefined;
var b = null;
var c = true;
var d = 'test';
var e = 10;
```

è¿™äº›å€¼ç›´æ¥åœ¨åº•å±‚å®ç°ä¸­è¡¨ç°ã€‚ä»–ä»¬ä¸æ˜¯å¯¹è±¡ï¼Œä»–ä»¬æ²¡æœ‰åŸå‹ï¼Œä¹Ÿæ²¡æœ‰æ„é€ å™¨ã€‚

å¦‚æœä¸èƒ½æ­£ç¡®ç†è§£ï¼Œ`typeof` æ“ä½œç¬¦å¯èƒ½å°±ä¸å¤ªç›´è§‚äº†ã€‚å…¸å‹çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨ `typeof` æ“ä½œç¬¦æ“ä½œ `null`ã€‚å½“ `typeof` æ“ä½œç¬¦æ“ä½œ `null` æ—¶ï¼Œæ— è®ºæ˜¯å¦å°† `null` æŒ‡å®šç»™ `Null`ï¼Œç»“æœéƒ½æ˜¯ `"object"` ã€‚

```jsx
console.log(typeof null); // "object"
```

åŸå› æ˜¯å› ä¸º `typeof` æ“ä½œç¬¦è¿”å›ä»æ ‡å‡†è¡¨ä¸­è·å–çš„å€¼ï¼Œç®€å•åœ°è¯´ï¼šâ€œå¯¹äº `null` å€¼åº”è¯¥è¿”å› `"object"` å­—ç¬¦ä¸²â€ã€‚

è§„èŒƒå¹¶æ²¡æœ‰æ¾„æ¸…æ­¤äº‹ï¼Œä½†æ˜¯ Brendan Eichï¼ˆJavascriptåˆ›é€ è€…ï¼‰æ³¨æ„åˆ°ï¼Œ `null` ä¸ `undefined` ç›¸æ¯”ï¼Œ `null` ä¸»è¦ç”¨äºå‡ºç°å¯¹è±¡çš„åœ°æ–¹ï¼Œå³ä¸å¯¹è±¡å¯†åˆ‡ç›¸å…³çš„æœ¬è´¨ï¼ˆæ„å‘³ç€å¯¹è±¡çš„â€œç©ºâ€å¼•ç”¨ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸ºæœªæ¥ç›®çš„ä¿ç•™äº†ä¸€ä¸ªä½ç½®ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨ä¸€äº›è‰ç¨¿ä¸­ï¼Œè¿™ç§â€œç°è±¡â€è¢«å½“ä½œä¸€ä¸ªå¹³å¸¸bugæè¿°çš„åœ°æ–¹æä¾›äº†æ–‡æ¡£ã€‚è€Œä¸”ï¼Œè¿™ä¸ªbugå‡ºç°çš„Brendan Eichä¹Ÿå‚ä¸çš„ä¸€ä¸ªbugè·Ÿè¸ªç¨‹åºä¸­ã€‚ç»“æœï¼Œå°½ç®¡ECMA-262-3æ ‡å‡†å°† `null` ç±»å‹å®šä¹‰ä¸º `Null` ï¼Œä½†æ˜¯è¿˜æ˜¯å†³å®šä¿ç•™ `typeof null` ä¸å˜ï¼Œå³ `"object"` ã€‚

### å¯¹è±¡ç±»å‹

åè¿‡æ¥ï¼Œ `Object` ç±»å‹ï¼ˆä¸è¦è¢« `Object` æ„é€ å‡½æ•°æ··æ·†ï¼Œæˆ‘ä»¬åªè®¨è®ºæŠ½è±¡çš„ç±»å‹ï¼‰æ˜¯ä»£è¡¨ECMAScirptå¯¹è±¡çš„å”¯ä¸€ç±»å‹ã€‚

> å¯¹è±¡æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„æ— åºé›†åˆã€‚

å¯¹è±¡çš„é”®æˆä¸ºå±æ€§ã€‚å±æ€§æ˜¯åŸå§‹å€¼ä¸å…¶ä»–å¯¹è±¡çš„å®¹å™¨ã€‚å¦‚æœå±æ€§åŒ…å«å‡½æ•°ä½œä¸ºå€¼ï¼Œé‚£å®ƒä»¬è¢«ç§°ä¸ºæ–¹æ³•ã€‚

ğŸŒ°ï¼š

```jsx
var x = { // object "x" with three properties: a, b, c
  a: 10, // primitive value
  b: {z: 100}, // object "b" with property z
  c: function () { // function (method)
    console.log('method x.c');
  }
};
 
console.log(x.a); // 10
console.log(x.b); // [object Object]
console.log(x.b.z); // 100
x.c(); // 'method x.c'
```

### åŠ¨æ€æ€§è´¨

æ­£å¦‚æˆ‘ä»¬åœ¨[7.1ç« èŠ‚](https://www.notion.so/tal007/ECMA-262-3-7-2-OOP-ECMAScript-4b89f91899c74d268b9b60e25a5ed143#0393e6d667094b42a967cb48afb21529)ä¸­æåˆ°çš„ï¼ŒESä¸­çš„å¯¹è±¡æ˜¯å®Œå…¨åŠ¨æ€çš„ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»ä½•æ—¶å€™å¯¹å¯¹è±¡çš„å±æ€§è¿›è¡Œæ·»åŠ ï¼Œä¿®æ”¹ä»¥åŠç§»é™¤ã€‚

ä¾‹å¦‚ï¼š

```jsx
var foo = {x: 10};
 
// add new property
foo.y = 20;
console.log(foo); // {x: 10, y: 20}
 
// change property value to function
foo.x = function () {
  console.log('foo.x');
};
 
foo.x(); // 'foo.x'
 
// delete property
delete foo.x;
console.log(foo); // {y: 20}
```

ä¸€äº›å±æ€§ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¸å¯é…ç½®çš„å±æ€§ï¼Œå³åªè¯»å±æ€§æˆ–è€…æ˜¯å·²åˆ é™¤çš„å±æ€§ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç« èŠ‚è€ƒè™‘è¿™äº›ã€‚

Noteï¼šES5æ ‡å‡†å®šåŒ–äº†é™æ€å¯¹è±¡ï¼Œä¸èƒ½ç”¨æ–°å±æ€§æ‰©å±•ï¼Œä»»ä½•å±æ€§ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹æˆ–è€…åˆ é™¤ã€‚è¿™äº›æˆä¸ºå†»ç»“å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ `Object.freeze(o)` æ–¹æ³•è·å¾—ã€‚

```jsx
var foo = {x: 10};
 
// freeze the object
Object.freeze(foo);
console.log(Object.isFrozen(foo)); // true
 
// can't modify
foo.x = 100;
 
// can't extend
foo.y = 200;
 
// can't delete
delete foo.x;
 
console.log(foo); // {x: 10}
```

è€Œä¸”ï¼Œä½¿ç”¨ `Object.preventExtensions(o)` æ–¹æ³•åªé˜»æ­¢æ‰©å±•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ–è€…ï¼Œä½¿ç”¨ `Object,defineProperty(o)` æ–¹æ³•æ§åˆ¶ç‰¹æ®Šçš„å±æ€§ã€‚

```jsx
var foo = {x : 10};
 
Object.defineProperty(foo, "y", {
  value: 20,
  writable: false, // read-only
  configurable: false // non-configurable
});
 
// can't modify
foo.y = 200;
 
// can't delete
delete foo.y; // false
 
// prevent extensions
Object.preventExtensions(foo);
console.log(Object.isExtensible(foo)); // false
 
// can't add new properties
foo.z = 30;
 
console.log(foo); {x: 10, y: 20}
```

æƒ³è¦äº†è§£è¯¦æƒ…ï¼Œé˜…è¯»[è¿™ç¯‡æ–‡ç« ](http://dmitrysoshnikov.com/ecmascript/es5-chapter-1-properties-and-property-descriptors/)ã€‚

### å†…ç½®ï¼ŒåŸç”Ÿä¸å®¿ä¸»å¯¹è±¡

æœ‰å¿…è¦æ³¨æ„çš„æ˜¯ï¼Œè§„èŒƒåŒºåˆ†äº†æœ¬åœ°å¯¹è±¡ï¼Œå†…ç½®å¯¹è±¡ä»¥åŠå®¿ä¸»å¯¹è±¡ã€‚

å†…ç½®å¯¹è±¡å’ŒåŸç”Ÿå¯¹è±¡æ˜¯ç”±ECMAScriptè§„èŒƒå’Œå®ç°å®šä¹‰ï¼Œä»–ä»¬ä¹‹å‰çš„åŒºåˆ«ä¸æ˜æ˜¾ã€‚ åŸç”Ÿå¯¹è±¡æ˜¯ECMAScriptå®ç°æä¾›çš„æ‰€æœ‰å¯¹è±¡ï¼ˆå…¶ä¸­ä¸€äº›å¯ä»¥å†…ç½®ï¼Œä¸€äº›å¯ä»¥åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´åˆ›å»ºï¼Œä¾‹å¦‚ç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ï¼‰ã€‚

å†…ç½®å¯¹è±¡å¯ä»¥ç®—æ˜¯åŸç”Ÿå¯¹è±¡çš„ä¸€ä¸ªå­ç±»ï¼Œåœ¨ç¨‹åºå¼€å§‹ä¹‹å‰å·²ç»å†…ç½®åˆ°äº†ECMAScriptä¸­ï¼ˆä¾‹å¦‚ `parseInt` ï¼Œ `Math` ç­‰ï¼‰ã€‚

æ‰€æœ‰çš„å®¿ä¸»å¯¹è±¡éƒ½æ˜¯ç”±å®¿ä¸»ç¯å¢ƒæä¾›ï¼Œä»£è¡¨æ˜¯æµè§ˆå™¨ï¼ŒåŒ…å«äº†è®¸å¤šå®¿ä¸»å¯¹è±¡ï¼Œä¾‹å¦‚ `window` ï¼Œ `console.log` ç­‰ç­‰ã€‚

æ³¨æ„ï¼Œå®¿ä¸»å¯¹è±¡å¯ä»¥ä½¿ç”¨ESè‡ªèº«å®ç°ï¼Œå¹¶ä¸”å®Œå…¨éµå¾ªè§„èŒƒè¯­ä¹‰ã€‚ä»è¿™ç‚¹æ¥çœ‹ï¼Œä»–ä»¬å¯ä»¥è¢«å«åšâ€œåŸç”Ÿå®¿ä¸»â€å¯¹è±¡ï¼ˆéæ­£å¼çš„å«æ³•ï¼‰ï¼Œè™½ç„¶ä¸»è¦æ˜¯ç†è®ºä¸Šçš„ã€‚è§„èŒƒå¹¶æ²¡æœ‰å®šä¹‰ä»»ä½•â€œåŸç”Ÿå®¿ä¸»â€çš„æ¦‚å¿µã€‚

### Booleanï¼Œ Stringå’ŒNumberå¯¹è±¡

å¯¹äºä¸€äº›åŸå§‹äº‹ç‰©ï¼Œè§„èŒƒå®šä¹‰äº†ç‰¹æ®Šçš„*åŒ…è£…å¯¹è±¡*ã€‚ä»–ä»¬æ˜¯ä»¥ä¸‹å¯¹è±¡ï¼š

- Boolean å¯¹è±¡
- String å¯¹è±¡
- Number å¯¹è±¡

è¿™äº›å¯¹è±¡æ˜¯ç”±ç›¸åº”çš„å†…ç½®æ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œå¹¶åŒ…å«äº†å†…ç½®å±æ€§ä½œä¸ºåŸå§‹å€¼ã€‚å¯¹è±¡è¡¨ç¤ºçš„å¯ä»¥è½¬è¡Œä¸ºåŸå§‹å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚

```jsx
var c = new Boolean(true);
var d = new String('test');
var e = new Number(10);
console.log(typeof c); // object
console.log(typeof d); // object
console.log(typeof e); // object
 
// converting to primitive
// conversion: ToPrimitive
// applying as a function, without "new" keyword
Ñ = Boolean(c);
d = String(d);
e = Number(e);
console.log(typeof c); // boolean
console.log(typeof d); // string
console.log(typeof e); // number
 
// back to Object
// conversion: ToObject
Ñ = Object(c);
d = Object(d);
e = Object(e);
console.log(typeof c); // object
console.log(typeof d); // object
console.log(typeof e); // object
```

é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿæœ‰é€šè¿‡ç‰¹æ®Šå†…ç½®å¯¹è±¡åˆ›å»ºçš„å¯¹è±¡ï¼š `Function` ï¼ˆå‡½æ•°å¯¹è±¡æ„é€ å™¨ï¼‰ï¼Œ `Array` ï¼ˆæ•°ç»„æ„é€ å™¨ï¼‰ï¼Œ `RegExp` ï¼ˆæ­£åˆ™è¡¨è¾¾å¼æ„é€ å™¨ï¼‰ï¼Œ `Math` ï¼ˆæ•°å­¦æ–¹æ³•ï¼‰ï¼Œ `Date` ï¼ˆæ—¥æœŸæ„é€ å™¨ï¼‰ç­‰ç­‰ã€‚è¿™äº›å¯¹è±¡ä¹Ÿæ˜¯ `Object` ç±»å‹çš„å€¼ï¼Œä»–ä»¬ä¹‹å‰çš„åŒºåˆ«æ˜¯ç”±å†…éƒ¨å±æ€§ç®¡ç†çš„ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºã€‚

### æ–‡å­—ç¬¦å·ï¼ˆå­—é¢ç¬¦å·ï¼‰

å¯¹äºä¸‰ä¸ªå¯¹è±¡å€¼ï¼š*objectï¼Œarrayå’Œregularè¡¨è¾¾å¼*ï¼Œæœ‰çŸ­è®°å·ï¼Œä»–ä»¬åˆ†åˆ«æˆä¸º*å¯¹è±¡åˆå§‹åŒ–ç¨‹åºï¼Œæ•°ç»„åˆå§‹åŒ–ç¨‹åºä¸æ­£åˆ™è¡¨è¾¾å¼æ–‡å­—*ï¼š

```jsx
// equivalent to new Array(1, 2, 3);
// or array = new Array();
// array[0] = 1;
// array[1] = 2;
// array[2] = 3;
var array = [1, 2, 3];
 
// equivalent to
// var object = new Object();
// object.a = 1;
// object.b = 2;
// object.c = 3;
var object = {a: 1, b: 2, c: 3};
 
// equivalent to new RegExp("^\\d+$", "g")
var re = /^\d+$/g;
```

æ³¨æ„ï¼Œåœ¨é‡æ–°åˆ†é…åç§°ï¼ˆ`Object`ï¼Œ`Array`ï¼Œæˆ–è€…`RegExp`ï¼‰åˆ°æ–°å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œåç»­ä½¿ç”¨æ–‡å­—ç¬¦å·çš„è¯­ä¹‰åœ¨å®ç°ä¸­å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚åœ¨å½“å‰ï¼ˆ2010.3.4ï¼‰Rhinoå®ç°ä¸­æˆ–è€…æ˜¯åœ¨æ—§çš„SpiderMonkey 1.7ç‰ˆæœ¬ä¸­ï¼Œé€‚å½“çš„æ–‡å­—ç¬¦å·å°†åˆ›å»ºä¸€ä¸ªä¸æ„é€ å‡½æ•°åç§°çš„å€¼ç›¸å¯¹åº”çš„å¯¹è±¡ã€‚åœ¨å…¶ä»–çš„å®ç°ä¸­ï¼Œå³ä½¿æ„é€ å‡½æ•°åç§°é‡æ–°ç»‘å®šåˆ°æ–°å¯¹è±¡ï¼Œä¹Ÿä¸ä¼šæ›´æ”¹æ–‡å­—ç¬¦å·çš„è¯­ä¹‰ï¼š

```jsx
var getClass = Object.prototype.toString;
 
Object = Number;
 
var foo = new Object;
console.log([foo, getClass.call(foo)]); // 0, "[object Number]"
 
var bar = {};
 
// in Rhino, SpiderMonkey 1.7 - 0, "[object Number]"
// in other: still "[object Object]", "[object Object]"
console.log([bar, getClass.call(bar)]);
 
// the same with Array name
Array = Number;
 
foo = new Array;
console.log([foo, getClass.call(foo)]); // 0, "[object Number]"
 
bar = [];
 
// in Rhino, SpiderMonkey 1.7 - 0, "[object Number]"
// in other: still "", "[object Object]"
console.log([bar, getClass.call(bar)]);
 
// but for RegExp, semantics of the literal
// isn't being changed in all tested implementations
 
RegExp = Number;
 
foo = new RegExp;
console.log([foo, getClass.call(foo)]); // 0, "[object Number]"
 
bar = /(?!)/g;
console.log([bar, getClass.call(bar)]); // /(?!)/g, "[object RegExp]"
```

### æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä»¥åŠRegExpå¯¹è±¡

æ³¨æ„ï¼Œåœ¨ES3ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼åœ¨è¯­ä¹‰ä¸Šç­‰æ•ˆçš„åä¸¤ç§æƒ…å†µä»ç„¶æœ‰æ‰€ä¸åŒã€‚æ­£åˆ™å­—é¢é‡åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ä¸­ï¼Œå¹¶åœ¨è§£æé˜¶æ®µè¢«åˆ›å»ºï¼Œè€Œ `RegExp` æ„é€ å‡½æ•°æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™å¯èƒ½ä¼šé€ æˆä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚å½“regexpæµ‹è¯•å¤±è´¥çš„æ—¶å€™ï¼Œregexpå¯¹è±¡çš„`lastIndex`å±æ€§ï¼š

```jsx
for (var k = 0; k < 4; k++) {
  var re = /ecma/g;
  console.log(re.lastIndex); // 0, 4, 0, 4
  console.log(re.test("ecmascript")); // true, false, true, false
}
 
// in contrast with
 
for (var k = 0; k < 4; k++) {
  var re = new RegExp("ecma", "g");
  console.log(re.lastIndex); // 0, 0, 0, 0
  console.log(re.test("ecmascript")); // true, true, true, true
}
```

æ³¨æ„ï¼šåœ¨ES5ä¸­è¿™ä¸ªé—®é¢˜è¢«ä¿®å¤äº†ï¼Œæ­£åˆ™å­—é¢é‡ä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡äº†ã€‚

### å…³è”æ•°ç»„ï¼Ÿ

é€šå¸¸åœ¨å„ç§æ–‡ç« æˆ–è€…è®¨è®ºä¸­ï¼ŒJavascriptå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯é€šè¿‡å£°æ˜å½¢å¼åˆ›å»ºçš„å¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡åˆå§‹åŒ– `{}`ï¼‰è¢«ç§°ä¸º*å“ˆå¸Œè¡¨*æˆ–è€…æ›´ç®€å•çš„*å“ˆå¸Œ*ï¼ˆRubyæˆ–è€…Perlä¸­çš„æœ¯è¯­ï¼‰ï¼Œ*å…³è”æ•°ç»„*ï¼ˆPHPä¸­çš„æœ¯è¯­ï¼‰ï¼Œ*è¯å…¸*ï¼ˆPythonä¸­çš„æœ¯è¯­ï¼‰ã€‚

ä½¿ç”¨è¿™ç§æœ¯è¯­æ˜¯å…·ä½“æŠ€æœ¯çš„ä¹ æƒ¯ã€‚çœŸçš„ï¼Œä»–ä»¬è¶³å¤Ÿç›¸ä¼¼ï¼Œå¹¶ä¸”å¯¹äºâ€œé”®-å€¼â€å¯¹ï¼Œå­˜å‚¨å®Œå…¨å¯¹åº”äºç†è®ºä¸Šçš„â€œå…³è”æ•°ç»„â€æˆ–â€œå“ˆå¸Œè¡¨â€æ•°æ®ç»“æ„ã€‚è€Œä¸”ï¼Œå“ˆå¸Œè¡¨æŠ½è±¡æ•°æ®ç±»å‹å¯èƒ½å¹¶ä¸”é€šå¸¸æ˜¯ç”¨åœ¨å®ç°çº§åˆ«ã€‚

ç„¶è€Œï¼Œè™½ç„¶ç”¨æœ¯è¯­äº†çš„æè¿°æ¦‚å¿µä¸Šçš„æ€ç»´æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºECMAScriptè€Œè¨€ï¼Œä»æŠ€æœ¯ä¸Šè€Œè¨€ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚æ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼ŒECMAScriptä»…ä»…åªæœ‰ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå¹¶ä¸”å…³äºâ€œé”®-å€¼â€å¯¹å­˜å‚¨çš„â€œå­ç±»å‹â€äº’ä¸å½±å“ã€‚å› æ­¤ï¼Œæ²¡æœ‰å•ç‹¬çš„ç‰¹æ®Šæœ¯è¯­ï¼ˆå“ˆå¸Œæˆ–è€…å…¶ä»–ï¼‰ã€‚å› ä¸ºä»»ä½•å¯¹è±¡ï¼ˆæ— è®ºå®ƒçš„å†…éƒ¨å±æ€§å¦‚ä½•ï¼‰éƒ½å¯ä»¥å­˜å‚¨ä»¥ä¸‹å¯¹ï¼š

```jsx
var a = {x: 10};
a['y'] = 20;
a.z = 30;
 
var b = new Number(1);
b.x = 10;
b.y = 20;
b['z'] = 30;
 
var c = new Function('');
c.x = 10;
c.y = 20;
c['z'] = 30;
 
// etc. â€“ with any object "subtype"
```

è€Œä¸”ï¼Œå› ä¸ºå§”æ´¾ï¼ŒECMAScriptä¸­çš„å¯¹è±¡å¯ä»¥æ˜¯éç©ºçš„ï¼Œå› æ­¤æœ¯è¯­â€œå“ˆå¸Œâ€ä¹Ÿå¯ä»¥æ˜¯ä¸æ­£ç¡®çš„ï¼š

```jsx
Object.prototype.x = 10;
 
var a = {}; // create "empty" "hash"
 
console.log(a["x"]); // 10, but it's not empty
console.log(a.toString); // function
 
a["y"] = 20; // add new pair to "hash"
console.log(a["y"]); // 20
 
Object.prototype.y = 20; // and property into the prototype
 
delete a["y"]; // remove
console.log(a["y"]); // but key and value are still here â€“ 20
```

**æ³¨æ„**ï¼ŒES5æ ‡å‡†äº†æ— é¡»åŸå‹å³å¯åˆ›å»ºå¯¹è±¡çš„åŠŸèƒ½ï¼Œå³ä»–ä»¬çš„åŸå‹è¢«è®¾ç½®ä¸º `null` ã€‚ä½¿ç”¨ `Object.create(null)` æ–¹æ³•å®ç°ã€‚ä»è¿™ç‚¹å‡ºå‘ï¼Œè¿™ç§å¯¹è±¡æ˜¯ç®€å•çš„å“ˆå¸Œè¡¨ï¼š

```jsx
var aHashTable = Object.create(null);
console.log(aHashTable.toString); // undefined
```

è€Œä¸”ï¼Œä¸€äº›å±æ€§å¯èƒ½æœ‰ç‰¹æ®Šçš„ getters/settersï¼Œå› æ­¤ä¹Ÿå¯èƒ½é€ æˆæ··æ·†ï¼š

```jsx
var a = new String("foo");
a['length'] = 10;
console.log(a['length']); // 3
```

ä½†æ˜¯ï¼Œå³ä½¿è€ƒè™‘åˆ°â€œå“ˆå¸Œâ€å¯èƒ½å…·æœ‰â€œåŸå‹â€ï¼ˆä¾‹å¦‚ï¼Œåœ¨Rubyæˆ–è€…Pythonä¸­ï¼Œä»£è¡¨å“ˆå¸Œå¯¹è±¡çš„ç±»ï¼‰ã€‚åœ¨ECMAScriptä¸­è¿™ä¸ªæœ¯è¯­ä¹Ÿå¯èƒ½ä¸æ­£ç¡®ï¼Œå› ä¸ºåœ¨å„ç§å±æ€§è®¿é—®å™¨ä¹‹é—´æ²¡æœ‰è¯­ä¹‰ä¸Šçš„åŒºåˆ«ï¼ˆä¾‹å¦‚ç‚¹å’Œæ‹¬å·ç¬¦å·ï¼‰ã€‚

åŒæ ·åœ¨ECMAScriptä¸­ï¼Œâ€œå±æ€§â€çš„æ¦‚å¿µåœ¨è¯­ä¹‰ä¸Šæ²¡æœ‰åˆ†ä¸ºâ€œé”®â€ï¼Œ â€œæ•°ç»„ç´¢å¼•â€ï¼Œ "æ–¹æ³•" æˆ–è€…â€œå±æ€§â€ã€‚åœ¨è¿™é‡Œï¼Œä»–ä»¬æ‰€æœ‰éƒ½æ˜¯ç”¨è¿‡æ£€æŸ¥åŸå‹é“¾æ¥éµå®ˆè¯»/å†™ç®—æ³•çš„ä¸€èˆ¬è§„åˆ™çš„å±æ€§ã€‚

ä¸‹é¢çš„Rubyçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°è¯­ä¹‰ä¸Šçš„åŒºåˆ«ï¼Œå› æ­¤ï¼Œè¿™é‡Œè¿™äº›æœ¯è¯­å¯èƒ½ä¸åŒï¼š

```ruby
a = {}
a.class # Hash
 
a.length # 0
 
# new "key-value" pair
a['length'] = 10;
 
# but semantics for the dot notation
# remains other and means access
# to the "property/method", but not to the "key"
 
a.length # 1
 
# and the bracket notation
# provides access to "keys" of a hash
 
a['length'] # 10
 
# we can augment dynamically Hash class
# with new properties/methods and they via
# delegation will be available for already created objects
 
class Hash
  def z
    100
  end
end
 
# a new "property" is available
 
a.z # 100
 
# but not a "key"
 
a['z'] # nil
```

ECMA-262-3æ ‡å‡†æ²¡æœ‰å®šä¹‰â€œå“ˆå¸Œâ€ï¼ˆä»¥åŠç±»ä¼¼çš„ï¼‰çš„æ¦‚å¿µã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦ä½¿ç”¨ç†è®ºä¸Šçš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å‘½åã€‚

### ç±»å‹è½¬æ¢

å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªåŸå§‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `valueOf` æ–¹æ³•ã€‚æ­£å¦‚æˆ‘ä»¬æåˆ°çš„ï¼Œæ„é€ å‡½æ•°ï¼ˆå¯¹äºæŸäº›ç±»å‹ï¼‰ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼Œä¾‹å¦‚ï¼Œæ²¡æœ‰ `new` æ“ä½œç¬¦çš„æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªåŸå§‹å€¼ã€‚å¯¹äºè¿™ç§è½¬æ¢ï¼Œéšå¼è°ƒç”¨äº† `valueOf` æ–¹æ³•ã€‚

```jsx
var a = new Number(1);
var primitiveA = Number(a); // implicit "valueOf" call
var alsoPrimitiveA = a.valueOf(); // explicit
 
console.log([
  typeof a, // "object"
  typeof primitiveA, // "number"
  typeof alsoPrimitiveA // "number"
]);
```

è¿™ä¸ªæ–¹æ³•è¿è¡Œå¯¹è±¡å‚ä¸å„ç§æ“ä½œï¼Œä¾‹å¦‚ï¼Œç›¸åŠ ï¼š

```jsx
var a = new Number(1);
var b = new Number(2);
 
console.log(a + b); // 3
 
// or even so
 
var c = {
  x: 10,
  y: 20,
  valueOf: function () {
    return this.x + this.y;
  }
};
 
var d = {
  x: 30,
  y: 40,
  // the same .valueOf
  // functionality as "Ñ" object has,
  // borrow it:
  valueOf: c.valueOf
};
 
console.log(c + d); // 100
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œ `valueOf` æ–¹æ³•çš„å€¼ï¼ˆå¦‚æœæ²¡æœ‰è¢«è¦†ç›–ï¼‰å¯ä»¥æ ¹æ®å¯¹è±¡ç±»å‹æœ‰æ‰€ä¸åŒã€‚å¯¹äºä¸€äº›å¯¹è±¡è¿”å›çš„æ˜¯ `this` å€¼ï¼Œä¾‹å¦‚ `Object.prototype.valueOf()` ï¼Œå¯¹äºå…¶ä»–çš„è¿”å›**ä»»ä½•å¯è®¡ç®—**çš„å€¼ã€‚ä¾‹å¦‚ `Date.prototype.valueOf()` ï¼Œè¿”å›çš„æ˜¯dateçš„æ—¶é—´ï¼š

```jsx
var a = {};
console.log(a.valueOf() === a); // true, "valueOf" returned this value
 
var d = new Date();
console.log(d.valueOf()); // time
console.log(d.valueOf() === d.getTime()); // true
```

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯¹è±¡çš„åŸå§‹è¡¨ç¤ºå½¢å¼ â€” å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚è¿™ä¸ªç”± `toStirng` æ–¹æ³•è´Ÿè´£ï¼Œåœ¨ä¸€äº›æ“ä½œä¸­ä¹Ÿæ˜¯è‡ªåŠ¨æ‰§è¡Œï¼š

```jsx
var a = {
  valueOf: function () {
    return 100;
  },
  toString: function () {
    return '__test';
  }
};
 
// in this operation
// toString method is
// called automatically
console.log(a); // "__test"  æ³¨æ„ï¼šåœ¨æœ€æ–°çš„ chrome ä¸­ å¹¶ä¸æ˜¯ä½œè€…è¯´çš„è¿™ä¸ªå€¼ è€Œæ˜¯ å¯¹è±¡ a
 
// but here - the .valueOf() method
console.log(a + 10); // 110
 
// but if there is no
// valueOf method, it
// will be replaced with the
//toString method
delete a.valueOf;
console.log(a + 10); // "_test10"
```

`toString` æ–¹æ³•å®šä¹‰åœ¨ `Object.prototype` ä¸Šï¼Œæœ‰ç€ç‰¹æ®Šçš„æ„ä¹‰ã€‚ä»–è¿”å›äº†å†…ç½®çš„ `[[Class]]` å±æ€§çš„å€¼ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºè¿™ä¸ªå€¼ã€‚

é™¤äº† `ToPrimitive` è½¬æ¢å¤–ï¼Œè¿˜æœ‰ `ToObject` è½¬æ¢ï¼Œåä¹‹äº¦ç„¶ï¼Œå°†å€¼è½¬æ¢ä¸ºå¯¹è±¡ç±»å‹ã€‚

ä¸€ä¸ªæ˜ç¡®çš„è°ƒç”¨ `ToObject` çš„æ–¹æ³•å°±æ˜¯å°†å†…ç½®çš„ `Object` æ„é€ å‡½æ•°ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨ï¼ˆå¯¹äºæŸäº›ç±»å‹ï¼Œä½¿ç”¨å¸¦æœ‰ `new` æ“ä½œç¬¦çš„ `Object` ä¹Ÿæ˜¯å¯èƒ½çš„ï¼‰ï¼š

```jsx
var n = Object(1); // [object Number]
var s = Object('test'); // [object String]
 
// also for some types it is
// possible to call Object with new operator
var b = new Object(true); // [object Boolean]
 
// but applied without arguments,
// new Object creates a simple object
var o = new Object(); // [object Object]
 
// in case if argument for Object function
// is already object value,
// it simply returns
var a = [];
console.log(a === new Object(a)); // true
console.log(a === Object(a)); // true
```

å°±å¸¦æœ‰ `new` ä¸ä¸å¸¦æœ‰ `new` æ“ä½œç¬¦è°ƒç”¨å†…ç½®æ„é€ å‡½æ•°è€Œè¨€ï¼Œæ²¡æœ‰é€šç”¨è§„åˆ™ï¼Œè¿™å–å†³äºæ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ `Array` å’Œ `Function` æ„é€ å‡½æ•°ï¼Œåœ¨ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨ï¼ˆæœ‰ `new` ï¼‰å’Œä½œä¸ºæ™®é€šå‡½æ•°ï¼ˆæ²¡æœ‰ `new` ï¼‰è°ƒç”¨æä¾›ç›¸åŒçš„ç»“æœã€‚

```jsx
var a = Array(1, 2, 3); // [object Array]
var b = new Array(1, 2, 3); // [object Array]
var c = [1, 2, 3]; // [object Array]
 
var d = Function(''); // [object Function]
var e = new Function(''); // [object Function]
```

è¿ç”¨æŸäº›æ“ä½œçš„æ—¶å€™ï¼Œè¿˜å­˜åœ¨æ˜¾ç¤ºä¸éšå¼çš„è½¬æ¢ï¼š

```jsx
var a = 1;
var b = 2;
 
// implicit
var c = a + b; // 3, number
var d = a + b + '5' // "35", string
 
// explicit
var e = '10'; // "10", string
var f = +e; // 10, number
var g = parseInt(e, 10); // 10, number
 
// etc.
```

### å±æ€§çš„å±æ€§

### å±æ€§çš„å±æ€§

æ‰€æœ‰çš„å±æ€§éƒ½æœ‰å¤§é‡çš„å±æ€§ï¼š

- `{readOnly}` ï¼šå°è¯•é‡å†™å±æ€§å€¼æ˜¯è¢«å¿½ç•¥çš„ï¼›ä½†æ˜¯ReadOnlyå±æ€§å¯ä»¥è¢«å®¿ä¸»ç¯å¢ƒæ“ä½œä¿®æ”¹ï¼Œå› æ­¤ï¼ŒReadOnlyä¸æ„å‘³ç€â€œä¸å˜çš„å€¼â€ã€‚
- `{DontEnum}` ï¼šå±æ€§ä¸èƒ½é€šè¿‡ `for...in` å¾ªç¯æšä¸¾
- `{DontDelete}` ï¼š `delete` æ“ä½œç”¨äºè¯¥å±æ€§å°†è¢«å¿½è§†
- `{Internal}` ï¼šå±æ€§æ˜¯å†…éƒ¨çš„ï¼Œæ²¡æœ‰åå­—å¹¶ä¸”åªèƒ½ç”¨åŸŸå®ç°çº§åˆ«ï¼›è¿™ç±»å±æ€§ä¸èƒ½åœ¨ECMAScriptç¨‹åºä¸­è®¿é—®ã€‚

**æ³¨æ„**ï¼Œåœ¨ES5ä¸­`{ReadOnly}`, `{DontEnum}` and `{DontDelete}` è¢«é‡å‘½åä¸ºç›¸åº”çš„ `[[Writable]]` , `[[Enumerable]]` ï¼Œ `[[Configurable]]` å¹¶ä¸”å¯ä»¥é€šè¿‡ `Object.defineProperty` å’Œç›¸ä¼¼çš„æ–¹æ³•æ‰‹åŠ¨ç®¡ç†ã€‚

```jsx
var foo = {};
 
Object.defineProperty(foo, "x", {
  value: 10,
  writable: true, // aka {ReadOnly} = false
  enumerable: false, // aka {DontEnum} = true
  configurable: true // {DontDelete} = false
});
 
console.log(foo.x); // 10
 
// attributes set is called a descriptor
var desc = Object.getOwnPropertyDescriptor(foo, "x");
 
console.log(desc.enumerable); // false
console.log(desc.writable); // true
// etc.
```

### å†…éƒ¨å±æ€§ä¸æ–¹æ³•

å¯¹è±¡ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤§é‡çš„å†…éƒ¨å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œä¸èƒ½ç›´æ¥ä¾›ECMAScriptç¨‹åºè®¿é—®ï¼ˆä½†æ˜¯æ­£å¦‚æˆ‘ä»¬ä¸‹é¢å°†çœ‹åˆ°çš„ï¼ŒæŸäº›å®ç°æ˜¯å…è®¸è®¿é—®è¿™äº›å±æ€§çš„ï¼‰ã€‚æŒ‰ç…§çº¦å®šï¼Œè¿™äº›å±æ€§ç”¨åŒæ–¹æ‹¬å· `[[]]` æ‹¬èµ·æ¥ã€‚

æˆ‘ä»¬å°†ä¼šæ¥è§¦åˆ°ä¸€äº›ï¼ˆæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯å¿…é¡»çš„ï¼‰ï¼›å…¶ä»–å±æ€§çš„æè¿°å¯ä»¥åœ¨è§„èŒƒä¸­æ‰¾åˆ°ã€‚

æ¯ä¸ªå¯¹è±¡éƒ½åº”è¯¥å®ç°ä»¥ä¸‹çš„å†…éƒ¨å±æ€§ä¸æ–¹æ³•ï¼š

- `[[Prototype]]` ï¼šå¯¹è±¡çš„åŸå‹ï¼ˆå°†ä¼šåœ¨ä¸‹é¢è¯¦ç»†è¯´æ˜ï¼‰ã€‚
- `[[Class]]` ï¼šä¸€ä¸ªä»£è¡¨å¯¹è±¡ç±»å‹çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼š `Object` ï¼Œ `Array` ï¼Œ `Function` ç­‰ç­‰ï¼‰ï¼›ç”¨äºåŒºåˆ†å¯¹è±¡ã€‚
- `[[Get]]` ï¼šç”¨äºè·å–å±æ€§å€¼çš„æ–¹æ³•
- `[[Put]]` ï¼šç”¨äºè®¾ç½®å±æ€§å€¼çš„æ–¹æ³•
- `[[CanPut]]` ï¼š æ£€æµ‹æ˜¯å¦å¯ä»¥é‡å†™å±æ€§
- `[[HasProperty]]` ï¼šæ£€æµ‹å¯¹è±¡æ˜¯å¦å·²ç»æ‹¥æœ‰è¿™ä¸ªå±æ€§
- `[[Delete]]` ï¼šä»å¯¹è±¡ä¸­ç§»é™¤å±æ€§
- `[[DefaultValue]]` ï¼šè¿”å›ä¸å¯¹è±¡ç›¸åº”çš„åŸå§‹å€¼ï¼ˆå¯¹äºè·å–å€¼ï¼Œ `valueOf` æ–¹æ³•è¢«è°ƒç”¨ï¼Œå¯¹äºä¸€äº›å¯¹è±¡ï¼ŒæŠ›å‡º `TypeError`  å¼‚å¸¸ï¼‰ã€‚

è¦ä»ECMAScriptç¨‹åºä¸­è·å¾— `[[Class]]` å±æ€§ï¼Œé€šè¿‡ `Object.property.toString()` æ–¹æ³•å¯ä»¥é—´æ¥è·å¾—ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›å¦‚ä¸‹å­—ç¬¦ä¸² `"[Object " + [[Class]] + "]"` ã€‚ä¾‹å¦‚ï¼š

```jsx
var getClass = Object.prototype.toString;
 
getClass.call({}); // [object Object]
getClass.call([]); // [object Array]
getClass.call(new Number(1)); // [object Number]
// etc.
```

è¿™ä¸ªç‰¹å¾å¸¸ç”¨äºæ£€æµ‹å¯¹è±¡çš„ç±»å‹ï¼Œç„¶è€Œï¼Œæœ‰å¿…è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡è§„èŒƒï¼Œå®¿ä¸»å¯¹è±¡çš„å†…éƒ¨ `[[Class]]` å±æ€§å¯ä»¥æ˜¯ä»»ä½•å€¼ï¼ŒåŒ…æ‹¬å†…ç½®å¯¹è±¡çš„ `[[Class]]` å€¼ï¼Œä»ç†è®ºä¸Šå°†ï¼Œä¸ä¼šè¿›è¡Œ100%è¯æ˜çš„è¿™ç§æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨è€ç‰ˆæœ¬çš„IEä¸­ï¼Œ `document.childNodes.item(...)` æ–¹æ³•çš„ `[[Class]]` å±æ€§è¿”å› `"String"` ï¼ˆåœ¨å…¶ä»–çš„å®ç°ä¸­ï¼Œè¿”å› `"Function"`ï¼‰

```jsx
// in older IE - "String", in other - "Function"
console.log(getClass.call(document.childNodes.item));
```

## æ„é€ å‡½æ•°

æˆ‘ä»¬ä¸Šé¢æåŠåˆ°ï¼ŒECMAScriptä¸­å¯¹è±¡æ˜¯é€šè¿‡å«åšæ„é€ å‡½æ•°çš„ä¸œè¥¿åˆ›å»ºçš„ã€‚

> æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªåˆ›å»ºä¸åˆå§‹åŒ–æ–°åˆ›å»ºå¯¹è±¡çš„å‡½æ•°ã€‚

å¯¹äºåˆ›å»ºï¼ˆå†…å­˜åˆ†é…ï¼‰ï¼Œç”±æ„é€ å‡½æ•°å†…éƒ¨çš„ `[[Constuct]]` æ–¹æ³•è´Ÿè´£ã€‚æŒ‡å®šäº†è¿™ä¸ªå†…éƒ¨æ–¹æ³•çš„è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€æœ‰æ„é€ å‡½æ•°éƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚

é€šè¿‡åœ¨æ–°åˆ›å»ºçš„å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨å‡½æ•°æ¥ç®¡ç†åˆå§‹åŒ–ã€‚æ„é€ å‡½æ•°ä¸­å·²ç»å­˜åœ¨çš„å†…éƒ¨ `[[Call]]` æ–¹æ³•è´Ÿè´£æ­¤è¡Œä¸ºã€‚

æ³¨æ„ï¼Œç”¨æˆ·ä»£ç ä¸­åªèƒ½è®¿é—®åˆå§‹é˜¶æ®µã€‚å› æ­¤ï¼Œå³ä½¿ä»åˆå§‹åŒ–å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„ `this` å¯¹è±¡è¿”å›ä¸åŒçš„å¯¹è±¡ï¼š

```jsx
function A() {
  // update newly created object
  this.x = 10;
  // but return different object
  return [1, 2, 3];
}
 
var a = new A();
console.log(a.x, a); undefined, [1, 2, 3]
```

å®šä½åˆ°[ç¬¬äº”ç« å‡½æ•°](https://mp.weixin.qq.com/s/0X2DxgEfS_bWxhTwKWx6UA)ä¸­è®²åˆ°çš„å‡½æ•°å¯¹è±¡çš„åˆ›å»ºæ³•åˆ™ï¼Œæˆ‘ä»¬çœ‹åˆ°å‡½æ•°æ˜¯ä¸€ä¸ªæœ¬åœ°å¯¹è±¡ï¼Œé™¤å…¶ä»–å±æ€§å¤–ï¼Œè¿˜æœ‰å†…éƒ¨çš„ `[[Construct]]` å’Œ `[[Call]]` å±æ€§ä»¥åŠæ˜¾ç¤ºçš„ `åŸå‹` å±æ€§ â€” å¯¹æœªæ¥å¯¹è±¡åŸå‹çš„å¼•ç”¨ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œä»¥åŠä¸‹é¢çš„ `NativeObject` æ˜¯æˆ‘å¯¹ECMA-262-3ä¸­"æœ¬åœ°å¯¹è±¡"çš„ä¼ªä»£ç å‘½åçº¦å®šï¼Œä½†ä¸æ˜¯å†…ç½®æ„é€ å‡½æ•°ï¼‰ã€‚

```jsx
F = new NativeObject();
 
F.[[Class]] = "Function"
 
.... // other properties
 
F.[[Call]] = <reference to function> // function itself
 
F.[[Construct]] = internalConstructor // general internal constructor
 
.... // other properties
 
// prototype of objects created by the F constructor
__objectPrototype = {};
__objectPrototype.constructor = F // {DontEnum}
F.prototype = __objectPrototype
```

å› æ­¤ï¼Œé™¤äº† `[[Class]]` å±æ€§ï¼ˆç­‰åŒäº `"Function"`ï¼‰ä¹‹å¤–çš„ `[[Call]]` æ˜¯åŒºåˆ†å¯¹è±¡çš„ä¸»è¦æ–¹æ³•ã€‚å› æ­¤ï¼Œå…·æœ‰å†…éƒ¨ `[[Call]]` å±æ€§çš„å¯¹è±¡è¢«ç§°ä¸º *functions*ã€‚å¯¹äºè¿™äº›å¯¹è±¡ï¼Œ `typeof` æ“ä½œç¬¦è¿”å› `"function"` å€¼ã€‚å› æ­¤ï¼Œå®ƒä¸»è¦ä¸æœ¬åœ°å¯¹è±¡æœ‰å…³ï¼Œåœ¨ä¸»æœºå¯ä»¥è°ƒç”¨å¯¹è±¡çš„æƒ…å†µä¸‹ï¼ŒæŸäº›å®ç°ä¸­çš„ `typeof` æ“ä½œç¬¦ï¼ˆä¸å°‘äº `[[Class]]` å±æ€§ï¼‰å¯èƒ½è¿”å›å…¶ä»–çš„å€¼ï¼Œä¾‹å¦‚ï¼Œåœ¨IEä¸­çš„ `window.console.log(...)`ï¼š

```jsx
// in IE - "Object", "object", in other - "Function", "function"
console.log(Object.prototype.toString.call(window.console.log));
console.log(typeof window.console.log); // "Object"
```

å†…éƒ¨çš„ `[[Construct]]` æ–¹æ³•ç”±ç”¨äºæ„é€ å‡½æ•°çš„ `new` æ“ä½œç¬¦æ¿€æ´»ã€‚æ­£å¦‚æˆ‘ä»¬è¯´çš„ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£å†…å­˜åˆ†é…ä»¥åŠæ–°å¯¹è±¡çš„åˆ›å»ºã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™å¯ä»¥çœç•¥æ„é€ å‡½æ•°çš„æ‹¬å·ï¼š

```jsx
function A(x) { // constructor Ğ
  this.x = x || 10;
}

// without arguments, call
// brackets can be omitted
var a = new A; // or new A();
console.log(a.x); // 10

// explicit passing of
// x argument value
var b = new A(20);
console.log(b.x); // 20
```

å¹¶ä¸”ï¼Œæ„é€ å‡½æ•°ï¼ˆåˆå§‹é˜¶æ®µï¼‰ä¸­çš„[thiså€¼](https://mp.weixin.qq.com/s/RfHEN1GwaYqz0z-9pEyv0A)è¢«è®¾ç½®ä¸ºæ–°åˆ›å»ºçš„è¿™ä¸ªå¯¹è±¡ã€‚

æˆ‘ä»¬æ¥ç»†æƒ³ä¸€ä¸‹å¯¹è±¡åˆ›å»ºçš„è®¡ç®—è§„åˆ™ã€‚

## å¯¹è±¡åˆ›å»ºçš„è®¡ç®—è§„åˆ™

å†…éƒ¨çš„ `[[Constuct]]` æ–¹æ³•çš„è¡Œä¸ºå¯ä»¥è¢«è¡¨ç¤ºä¸ºï¼š

```jsx
F.[[Construct]](initialParameters):

O = new NativeObject();

// property [[Class]] is set to "Object", i.e. simple object
O.[[Class]] = "Object"

// get the object on which
// at the moment references F.prototype
var __objectPrototype = F.prototype;

// if __objectPrototype is an object, then:
O.[[Prototype]] = __objectPrototype
// else:
O.[[Prototype]] = Object.prototype;
// where O.[[Prototype]] is the prototype of the object

// initialization of the newly created object
// applying the F.[[Call]]; pass:
// as this value â€“ newly created object - O,
// arguments are the same as initialParameters for F
R = F.[[Call]](initialParameters); this === O;
// where R is the returned value of the [[Call]]
// in JS view it looks like:
// R = F.apply(O, initialParameters);

// if R is an object
return R
// else
return O
```

æ³¨æ„ä¸¤ä¸ªä¸»è¦çš„ç‰¹å¾ï¼š

ç¬¬ä¸€ï¼Œåˆ›å»ºå¯¹è±¡çš„ *prototype* å±æ€§æ˜¯æ¥è‡ªäºå½“å‰æ—¶åˆ»å‡½æ•°çš„ `prototype` å±æ€§ï¼ˆè¿™å°±æ„å‘³ç€ä»ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡çš„å±æ€§å¯ä»¥æ”¹å˜ï¼Œå› ä¸ºå‡½æ•°çš„ `prototype` å±æ€§ä¹Ÿå¯ä»¥æ”¹å˜ï¼‰ã€‚

ç¬¬äºŒï¼Œæˆ‘ä»¬ä¸Šé¢æåˆ°ï¼Œå¦‚æœåœ¨å¯¹è±¡åˆå§‹æ—¶ `[[Call]]` è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å°†å…¶ä½œä¸ºæ•´ä¸ª `new` è¡¨è¾¾å¼çš„ç»“æœï¼š

```jsx
function A() {}
A.prototype.x = 10;

var a = new A();
console.log(a.x); // 10 â€“ by delegation, from the prototype

// set .prototype property of the
// function to new object; why explicitly
// to define the .constructor property,
// will be described below
A.prototype = {
  constructor: A,
  y: 100
};

var b = new A();
// object "b" has new prototype
console.log(b.x); // undefined
console.log(b.y); // 100 â€“ by delegation, from the prototype

// however, prototype of the "a" object
// is still old (why - we will see below)
console.log(a.x); // 10 - by delegation, from the prototype

function B() {
  this.x = 10;
  return new Array();
}

// if "B" constructor had not return
// (or was return this), then this-object
// would be used, but in this case â€“ an array
var b = new B();
console.log(b.x); // undefined
console.log(Object.prototype.toString.call(b)); // [object Array]
```

æˆ‘ä»¬å†æ¥æ·±å…¥çš„äº†è§£ä¸€ä¸‹åŸå‹ã€‚

## Prototype

æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å«æœ‰ä¸€ä¸ªåŸå‹ï¼ˆæŸäº›ç³»ç»Ÿå¯¹è±¡å¯ä»¥ä¾‹å¤–ï¼‰ã€‚é€šè¿‡å†…éƒ¨çš„ï¼Œéšå¼çš„å’Œä¸å¯è®¿é—®çš„ `[[Protorype]]` å±æ€§æ¥ç»„ç»‡ä¸åŸå‹çš„é€šä¿¡ã€‚ä¸€ä¸ªå±æ€§å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª `null` å¯¹è±¡ã€‚

## Property `constructor`

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ä¸¤ç‚¹å¾ˆé‡è¦ã€‚ç¬¬ä¸€ä¸å‡½æ•°`prototype`å±æ€§çš„æ„é€ å‡½æ•°å±æ€§æœ‰å…³ã€‚

æ­£å¦‚æˆ‘ä»¬åœ¨å‡½æ•°å¯¹è±¡åˆ›å»ºç®—æ³•ä¸­çœ‹åˆ°çš„ï¼Œåœ¨å‡½æ•°åˆ›å»ºé˜¶æ®µï¼Œ `constructor` å±æ€§è®¾ç½®åˆ°å‡½æ•°çš„ `prototype` å±æ€§ä¸­ã€‚æ­¤å±æ€§çš„å€¼æ˜¯å¯¹å‡½æ•°æœ¬èº«çš„*å¾ªç¯å¼•ç”¨*ï¼š

```jsx
function A() {}
var a = new A();
console.log(a.constructor); // function A() {}, by delegation
console.log(a.constructor === A); // true
```

é€šå¸¸è¿™ç§æƒ…å†µä¸‹æœ‰`è¯¯è§£` â€” `constructor` å±æ€§*é”™è¯¯çš„*è¢«å½“ä½œåˆ›å»ºå¯¹è±¡çš„è‡ªèº«å±æ€§ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªå±æ€§å±äºåŸå‹ï¼Œå¹¶ä¸”é€šè¿‡ç»§æ‰¿è®¿é—®å¯¹è±¡ã€‚

é€šè¿‡ç»§æ‰¿çš„ `constructor` å±æ€§å®ä¾‹å¯ä»¥é—´æ¥çš„è·å–åŸå‹å¯¹è±¡çš„å¼•ç”¨ï¼š

```jsx
function A() {}
A.prototype.x = new Number(10);
 
var a = new A();
console.log(a.constructor.prototype); // [object Object]
 
console.log(a.x); // 10, via delegation
// the same as a.[[Prototype]].x
console.log(a.constructor.prototype.x); // 10
 
console.log(a.constructor.prototype.x === a.x); // true
```

æ³¨æ„ï¼Œå‡½æ•°çš„ `constructor` å’Œ `prototype` å¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºåé‡æ–°å®šä¹‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è±¡å¤±å»é€šè¿‡ä¸Šé¢æœºåˆ¶çš„å¼•ç”¨ã€‚

å¦‚æœæˆ‘ä»¬åœ¨åŸæ¥çš„åŸå‹ä¸­é€šè¿‡å‡½æ•°çš„`prototype` å±æ€§æ·»åŠ æ–°çš„æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„å±æ€§ï¼Œå®ä¾‹å°†ä¼šçœ‹åˆ°æœ€æ–°çš„æ·»åŠ çš„å±æ€§ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å®Œå…¨ä¿®æ”¹äº†å‡½æ•°çš„`prototype` å±æ€§ï¼ˆé€šè¿‡èµ‹å€¼ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰ï¼Œå¤±å»åŸæ¥æ„é€ å‡½æ•°ï¼ˆä»¥åŠåŸæ¥çš„åŸå‹ï¼‰çš„å¼•ç”¨ã€‚è¿™æ˜¯å› ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰`constructor` å±æ€§ã€‚

```jsx
function A() {}
A.prototype = {
  x: 10
};
 
var a = new A();
console.log(a.x); // 10
console.log(a.constructor === A); // false!
```

å› æ­¤ï¼Œå¼•ç”¨åº”è¯¥æ‰‹åŠ¨ä¿®å¤ï¼š

```jsx
function A() {}
A.prototype = {
  constructor: A,
  x: 10
};
 
var a = new A();
console.log(a.x); // 10
console.log(a.constructor === A); // true
```

æ³¨æ„ï¼Œæ‰‹åŠ¨æ·»åŠ çš„ `constructor` å±æ€§ä¸åŸæ¥çš„ç›¸æ¯”ï¼Œæ²¡æœ‰ `{DontEnum}` å±æ€§ï¼Œç»“æœå°±æ˜¯ï¼Œåœ¨ `A.prototype` ä¸­å¯ä»¥é€šè¿‡ `for...in` å¾ªç¯æšä¸¾ï¼š

ES5ä¸­å¼•å…¥äº†é€šè¿‡`[[Enumerable]]`å±æ€§æ§åˆ¶å±æ€§çš„å¯æšä¸¾çŠ¶æ€çš„èƒ½åŠ›ã€‚

```jsx
var foo = {x: 10};
 
Object.defineProperty(foo, "y", {
  value: 20,
  enumerable: false // aka {DontEnum} = true
});
  
console.log(foo.x, foo.y); // 10, 20
 
for (var k in foo) {
  console.log(k); // only "x"
}
 
var xDesc = Object.getOwnPropertyDescriptor(foo, "x");
var yDesc = Object.getOwnPropertyDescriptor(foo, "y");
 
console.log(
  xDesc.enumerable, // true
  yDesc.enumerable  // false
);
```

### æ˜¾ç¤º `prototype` ä¸éšå¼çš„ `[[Prototype]]` å±æ€§

é€šè¿‡å‡½æ•°çš„`prototype`å±æ€§ç›´æ¥å¼•ç”¨åŸå‹ï¼Œé€šå¸¸å¯¹è±¡çš„åŸå‹è¢«é”™è¯¯çš„æ··æ·†ã€‚æ˜¯çš„ï¼ŒçœŸçš„ï¼Œä»–å¼•ç”¨äº†ç›¸åŒçš„å¯¹è±¡ï¼Œå³å¯¹è±¡çš„ `[[Prototype]]` å±æ€§ï¼š

```jsx
a.[[Prototype]] ----> Prototype <---- A.prototype
```

è€Œä¸”ï¼Œåœ¨å¯¹è±¡åˆ›å»ºé˜¶æ®µï¼Œå®ä¾‹çš„ `[[Prototype]]` å®Œå…¨ä»æ„é€ å‡½æ•°çš„`prototype`å±æ€§ä¸Šè·å–å€¼ã€‚

ç„¶è€Œï¼Œæ›¿æ¢æ„é€ å‡½æ•°çš„`prototype`å±æ€§ä¸å½±å“å·²ç»åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹ã€‚ä»…ä»…åªæ˜¯å®ƒçš„æ„é€ å‡½æ•°çš„`prototype`å±æ€§æ”¹å˜äº†ã€‚è¿™æ„å‘³ç€æ–°å¯¹è±¡ä¼šæœ‰ä¸€ä¸ªæ–°çš„åŸå‹ã€‚ä½†æ˜¯å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼ˆåœ¨ `prototype` å±æ€§ä¿®æ”¹ä¹‹å‰ï¼‰ï¼Œæ‹¥æœ‰æ—§çš„åŸå‹çš„å¼•ç”¨ï¼Œå¹¶ä¸”å¼•ç”¨ä¸èƒ½è¢«ä¿®æ”¹ã€‚

```jsx
// was before changing of A.prototype
a.[[Prototype]] ----> Prototype <---- A.prototype
 
// became after
A.prototype ----> New prototype // new objects will have this prototype
a.[[Prototype]] ----> Prototype // reference to old prototype
```

ğŸŒ°ï¼š

```jsx
function A() {}
A.prototype.x = 10;
 
var a = new A();
console.log(a.x); // 10
 
A.prototype = {
  constructor: A,
  x: 20
  y: 30
};
 
// object "Ğ°" delegates to
// the old prototype via
// implicit [[Prototype]] reference
console.log(a.x); // 10
console.log(a.y) // undefined
 
var b = new A();
 
// but new objects at creation
// get reference to new prototype
console.log(b.x); // 20
console.log(b.y) // 30
```

å› æ­¤ï¼Œæœ‰æ—¶å€™åœ¨å…³äºJavaScriptçš„æ–‡ç« ä¸­ä¼šå‡ºç°å£°æ˜ï¼Œå£°ç§°â€œ*åŠ¨æ€ä¿®æ”¹åŸå‹å°†ä¼šå½±å“æ‰€æœ‰çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä»–ä»¬å°†ä¼šæ‹¥æœ‰æ–°çš„åŸå‹*â€**æ˜¯é”™è¯¯çš„**ã€‚æ–°çš„åŸå‹åªæœ‰åœ¨è¿™ä¸ªä¿®æ”¹ä»¥ååˆ›å»ºçš„æ–°å¯¹è±¡æ‰æœ‰ã€‚

è¿™é‡Œä¸»è¦çš„è§„åˆ™æ˜¯ï¼šå¯¹è±¡çš„åŸå‹æ˜¯åœ¨å¯¹è±¡åˆ›å»ºé‚£ä¸€åˆ»è®¾ç½®çš„ï¼Œå¹¶ä¸”åœ¨é‚£ä¹‹åä¸èƒ½è¢«ä¿®æ”¹ä¸ºæ–°å¯¹è±¡ã€‚å¦‚æœæ„é€ å‡½æ•°ä»å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨è¯¥å¯¹è±¡çš„æ˜¾ç¤ºåŸå‹å¼•ç”¨ï¼Œåªèƒ½æ·»åŠ æ–°çš„å±æ€§æˆ–è€…ä¿®æ”¹å¯¹è±¡åŸå‹å·²ç»å­˜åœ¨çš„å±æ€§ã€‚

### éæ ‡å‡†çš„ `__proto__` å±æ€§

ç„¶è€Œï¼Œä¸€äº›å®ç°ä¸­ï¼Œä¾‹å¦‚ï¼ŒSpiderMonkeyï¼Œé€šè¿‡éæ ‡å‡†çš„ `__proto__` å±æ€§æä¾›å¯¹è±¡åŸå‹çš„æ˜¾ç¤ºå¼•ç”¨ï¼š

```jsx
function A() {}
A.prototype.x = 10;
 
var a = new A();
console.log(a.x); // 10
 
var __newPrototype = {
  constructor: A,
  x: 20,
  y: 30
};
 
// reference to new object
A.prototype = __newPrototype;
 
var b = new A();
console.log(b.x); // 20
console.log(b.y); // 30
 
// "a" object still delegates
// to the old prototype
console.log(a.x); // 10
console.log(a.y); // undefined
 
// change prototype explicitly
a.__proto__ = __newPrototype;
 
// now "Ğ°" object references
// to new object also
console.log(a.x); // 20
console.log(a.y); // 30
```

æ³¨æ„ï¼ŒES5ä¸­å¼•è¿›äº† `Object.getPrototypeOf(o)` æ–¹æ³•ï¼Œç›´æ¥è¿”å›å¯¹è±¡çš„ `[[Prototype]]` å±æ€§ â€” å®ä¾‹åŸæ¥çš„å±æ€§ã€‚ä½†æ˜¯ï¼Œä¸ `__proto__` ç›¸æ¯”ï¼Œä½œä¸ºä¸€ä¸ª `getter` ï¼Œä»–ä¸è¢«å…è®¸è®¾ç½®å±æ€§ã€‚

```jsx
var foo = {};
Object.getPrototypeOf(foo) == Object.prototype; // true
```

### å¯¹è±¡ç‹¬ç«‹äºå…¶æ„é€ å‡½æ•°

å› ä¸ºå®ä¾‹çš„åŸå‹ç‹¬ç«‹äºæ„é€ å‡½æ•°å’Œæ„é€ å‡½æ•°çš„`prototype`å±æ€§ï¼Œæ„é€ å‡½æ•°åœ¨å®Œæˆå®ƒçš„ä¸»è¦ç›®çš„ï¼ˆåˆ›å»ºå¯¹è±¡ï¼‰åï¼Œå¯ä»¥ç§»é™¤ã€‚åŸå‹å¯¹è±¡å°†ä¼šç»§ç»­å­˜åœ¨ï¼Œé€šè¿‡ `[[Prototype]]` å±æ€§è¢«å¼•ç”¨ã€‚

```jsx
function A() {}
A.prototype.x = 10;
 
var a = new A();
console.log(a.x); // 10
 
// set "Ğ" to null - explicit
// reference on constructor
A = null;
 
// but, still possible to create
// objects via indirect reference
// from other object if
// .constructor property has not been changed
var b = new a.constructor();
console.log(b.x); // 10
 
// remove implicit reference
// after it `a.constructor`, and `b.constructor`
// will point to the default Object function, but not `A`
delete a.constructor.prototype.constructor;
 
// it is not possible to create objects
// of "Ğ" constructor anymore, but still
// there are two such objects which
// still have reference to their prototype
console.log(a.x); // 10
console.log(b.x); // 10
```

### `instanceof` æ“ä½œçš„ç‰¹å¾

é€šè¿‡æ„é€ å‡½æ•°çš„`prototype`å±æ€§æ˜¾ç¤ºå¼•ç”¨åŸå‹ï¼Œä¸ `instanceof` æ“ä½œç¬¦çš„å·¥ä½œç›¸å…³ã€‚

è¯¥æ“ä½œç¬¦ä¸å¯¹è±¡çš„åŸå‹é“¾å®Œå…¨ååŒå·¥ä½œï¼Œä½†ä¸ä¸æ„é€ å‡½æ•°æœ¬èº«ååŒå·¥ä½œã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºè¿™é‡Œç»å¸¸æœ‰è¯¯è§£ã€‚å› æ­¤ï¼Œæœ‰ä¸€ä¸ªæ£€æŸ¥ï¼š

```jsx
if (foo instanceof Foo) {
	...
}
```

è¿™å¹¶ä¸æ„å‘³ç€æ£€æŸ¥ `foo` å¯¹è±¡æ˜¯å¦ç”± `Foo` æ„é€ å‡½æ•°åˆ›å»ºã€‚

 `instanceof` æ“ä½œç¬¦çš„æ‰€æœ‰å·¥ä½œåªæ˜¯è·å– `Foo.prototype` å±æ€§çš„å€¼ä»¥åŠä» `foo.[[Prototype]]` å¼€å§‹æ£€æŸ¥ `foo` çš„ä½œç”¨åŸŸé“¾æ˜¯å¦å­˜åœ¨ã€‚ `instanceof` æ“ä½œç¬¦æ˜¯ç”±æ„é€ å‡½æ•°å†…éƒ¨çš„ [[HasInstace]] æ–¹æ³•æ¿€æ´»ã€‚

ä»ä¾‹å­å‡ºå‘æ¥çœ‹çœ‹ï¼š

```jsx
function A() {}
A.prototype.x = 10;
 
var a = new A();
console.log(a.x); // 10
 
console.log(a instanceof A); // true
 
// if set A.prototype
// to null...
A.prototype = null;
 
// ...then "a" object still
// has access to its
// prototype - via a.[[Prototype]]
console.log(a.x); // 10
 
// however, instanceof operator
// can't work anymore, because
// starts its examination from the
//prototype property of the constructor
console.log(a instanceof A); // error, A.prototype is not an object
```

å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥ç”±ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯é€šè¿‡å¦ä¸€ä¸ªå¯¹è±¡æ£€æµ‹ `instanceof` å°†ä¼šè¿”å› `true` ã€‚å¾ˆæœ‰å¿…è¦è®¾ç½®å¯¹è±¡çš„ `[[Prototype]]` å±æ€§å’Œæ„é€ å‡½æ•°çš„ `prototype` å±æ€§åˆ°ç›¸åŒçš„å¯¹è±¡ï¼š

```jsx
function B() {}
var b = new B();
 
console.log(b instanceof B); // true
 
function C() {}
 
var __proto = {
  constructor: C
};
 
C.prototype = __proto;
b.__proto__ = __proto;
 
console.log(b instanceof C); // true
console.log(b instanceof B); // false
```

### åŸå‹ä½œä¸ºæ–¹æ³•å’Œå…±äº«å±æ€§çš„å­˜å‚¨

åœ¨ECMAScriptä¸­åŸå‹ æœ€æœ‰ç”¨çš„åº”ç”¨æ˜¯å­˜å‚¨å¯¹è±¡çš„æ–¹æ³•ã€é»˜è®¤çŠ¶æ€å’Œå…±äº«å±æ€§ã€‚

çš„ç¡®ï¼Œå¯¹è±¡å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå½“æ—¶æ–¹æ³•é€šå¸¸éƒ½æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œä¸ºäº†ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæ–¹æ³•é€šå¸¸è¢«å®šä¹‰åœ¨åŸå‹ä¸Šé¢ã€‚è¿™æ„å‘³ç€æ‰€æœ‰é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹æ€»æ˜¯å…±äº«ç›¸åŒçš„æ–¹æ³•ã€‚

```jsx
function A(x) {
  this.x = x || 100;
}
 
A.prototype = (function () {
 
  // initializing context,
  // use additional object
 
  var _someSharedVar = 500;
 
  function _someHelper() {
    console.log('internal helper: ' + _someSharedVar);
  }
 
  function method1() {
    console.log('method1: ' + this.x);
  }
 
  function method2() {
    console.log('method2: ' + this.x);
    _someHelper();
  }
 
  // the prototype itself
  return {
    constructor: A,
    method1: method1,
    method2: method2
  };
 
})();
 
var a = new A(10);
var b = new A(20);
 
a.method1(); // method1: 10
a.method2(); // method2: 10, internal helper: 500
 
b.method1(); // method1: 20
b.method2(); // method2: 20, internal helper: 500
 
// both objects are use
// the same methods from
// the same prototype
console.log(a.method1 === b.method1); // true
console.log(a.method2 === b.method2); // true
```

## è¯»å†™å±æ€§

 æˆ‘ä»¬æåˆ°ï¼Œå±æ€§çš„è¯»å†™æ˜¯ç”±å†…éƒ¨çš„ `[[Get]]` å’Œ `[[Put]]` æ–¹æ³•ç®¡ç†ã€‚è¿™ä¸ªæ–¹æ³•ç”±å±æ€§è®¿é—®å™¨å³æ“ç¬¦å·å’Œæ‹¬å·ç¬¦å·æ¿€æ´»ã€‚

```jsx
// write
foo.bar = 10; // [[Put]] is called
 
console.log(foo.bar); // 10, [[Get]] is called
console.log(foo['bar']); // the same
```

è®©æˆ‘ä»¬ç”¨ä¼ªä»£ç æ¥å±•ç¤ºè¿™äº›æ–¹æ³•çš„å·¥ä½œåŸç†ã€‚

### `[[Get]]` æ–¹æ³•

`[[Get]]` æ–¹æ³•ä¹Ÿä¼šè€ƒè™‘åˆ°æ¥è‡ªå¯¹è±¡ä½œç”¨åŸŸé“¾çš„å±æ€§ã€‚å› æ­¤åŸå‹çš„å±æ€§å¯ä»¥ä½œä¸ºè‡ªå·±çš„å¯¹è±¡æ–¹æ³•ã€‚

```jsx
O.[[Get]](P):
 
// å¦‚æœæœ‰è‡ªå·±çš„å±æ€§ï¼Œè¿”å›ä»–
if (O.hasOwnProperty(P)) {
  return O.P;
}
 
// å¦åˆ™åˆ†æå±æ€§
var __proto = O.[[Prototype]];
 
// å¦‚æœæ²¡æœ‰åŸå‹ (è¿™æ˜¯å¯èƒ½çš„ï¼Œåœ¨é“¾çš„æœ€åï¼Œ
// Object.prototype.[[Prototype]]ç­‰äºnull),
// è¿”å›undefined;
if (__proto === null) {
  return undefined;
}
 
// å¦åˆ™ï¼Œé€’å½’è°ƒç”¨[[Get]]æ–¹æ³•ï¼Œä»åŸå‹å¼€å§‹ï¼Œç”¨è¿‡åŸå‹é“¾æ‰¾åˆ°åŸå‹çš„å±æ€§ï¼Œ
// æ­¤åç»§ç»­ ç›´åˆ°[[Prototype]]ç­‰äºnull
return __proto.[[Get]](P)
```

æ³¨æ„ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ `[[Get]]` æ–¹æ³•è¿”å› `undefined` ï¼Œå› æ­¤å¯ä»¥æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š

```jsx
if (window.someObject) {
	...
}
```

è¿™é‡Œï¼Œå±æ€§ `someObject` æ²¡æœ‰åœ¨ `window` ä¸­æ‰¾åˆ°ï¼Œæ¥ç€åœ¨å®ƒçš„åŸå‹æ‰¾ï¼Œåœ¨åŸå‹çš„åŸå‹æ‰¾ï¼Œä¾æ¬¡é€’å½’ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ç›´æ²¡æ‰¾åˆ°ï¼Œé€šè¿‡ç®—æ³•ï¼Œè¿”å› `undefined` å€¼ã€‚

æ³¨æ„ï¼Œå¯¹äºç¡®åˆ‡å­˜åœ¨è¿™ä»¶äº‹ï¼Œç”± `in` æ“ä½œç¬¦è´Ÿè´£ã€‚ä»–ä¹ŸåŒ…å«äº†åŸå‹é“¾ï¼š

```jsx
if ('someObject' in window) {
  ...
}
```

å®ƒæœ‰åŠ©äºé¿å…æŸäº›æƒ…å†µï¼Œä¾‹å¦‚ `someObject` ç­‰äº `false` ä»¥åŠå³ä½¿ `someObject` å­˜åœ¨ä¹Ÿä¸ä¼šé€šè¿‡ç¬¬ä¸€æ¬¡æ£€æµ‹ã€‚

### `[[Put]]` æ–¹æ³•

ç›¸åï¼Œ`[[Put]]` æ–¹æ³•åˆ›å»ºæˆ–è€…æ›´æ–°å¯¹è±¡çš„è‡ªèº«å±æ€§ï¼Œå¹¶ç”¨åŸå‹ä¸­ç›¸åŒçš„åå­—é®ç›–å±æ€§ã€‚

```jsx
O.[[Put]](P, V):
 
// å¦‚æœæˆ‘ä»¬ä¸èƒ½å†™å…¥å±æ€§ï¼Œåˆ™é€€å‡º
if (!O.[[CanPut]](P)) {
  return;
}
 
// å¦‚æœå¯¹è±¡æ²¡æœ‰è¿™äº›å±æ€§ï¼Œåˆ›å»ºå®ƒï¼Œæ‰€æœ‰å±æ€§éƒ½è®¾ç½®ä¸ºfalse
if (!O.hasOwnProperty(P)) {
  createNewProperty(O, P, attributes: {
    ReadOnly: false,
    DontEnum: false,
    DontDelete: false,
    Internal: false
  });
}
 
// è®¾ç½®å€¼ï¼Œå¦‚æœå±æ€§å­˜åœ¨ï¼Œå®ƒçš„å±æ€§ä¸èƒ½ä¿®æ”¹
O.P = V
 
return;
```

ä¾‹å¦‚ï¼š

```jsx
Object.prototype.x = 100;
 
var foo = {};
console.log(foo.x); // 100, inherited
 
foo.x = 10; // [[Put]]
console.log(foo.x); // 10, own
 
delete foo.x;
console.log(foo.x); // again 100, inherited
```

æ³¨æ„ï¼šæœ‰å¯èƒ½éšè—å†…éƒ¨çš„åªè¯»å±æ€§ã€‚åˆ†é…ç»“æœå°†è¢«å¿½ç•¥ã€‚è¿™ä¸ªè¢«å†…éƒ¨çš„ `[[CanPut]]` æ–¹æ³•æ§åˆ¶

```jsx
// For example, property "length" of
// string objects is read-only; let's make a
// string as a prototype of our object and try
// to shadow the "length" property
 
function SuperString() {
  /* nothing */
}
 
SuperString.prototype = new String("abc");
 
var foo = new SuperString();
 
console.log(foo.length); // 3, the length of "abc"
 
// try to shadow
foo.length = 5;
console.log(foo.length); // still 3
```

åœ¨ES5çš„[ä¸¥æ ¼æ¨¡å¼](http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/)ä¸‹ï¼Œå°è¯•éšè—ä¸å¯å†™å±æ€§ä¼šå¯¼è‡´TypeErrorã€‚

### å±æ€§è®¿é—®å™¨

åœ¨ECMAScriptä¸­ï¼Œå†…éƒ¨çš„ `[[Get]]` å’Œ `[[Put]]` æ–¹æ³•ç”±å±æ€§è®¿é—®å™¨æ¿€æ´»ï¼Œå¯ä»¥é€šè¿‡ç‚¹ç¬¦å·æˆ–è€…é€šè¿‡æ‹¬å·ç¬¦å·è·å¾—ã€‚ç‚¹ç¬¦å·è¢«ç”¨äºå±æ€§åæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡è¯†ç¬¦åå­—ä»¥åŠæå‰çŸ¥é“çš„æ—¶å€™ï¼Œæ‹¬å·ç¬¦å·å…è®¸åŠ¨æ€ç”Ÿæˆçš„å±æ€§åç§°ã€‚

```jsx
var a = {testProperty: 10};
 
console.log(a.testProperty); // 10, dot notation
console.log(a['testProperty']); // 10, bracket notation
 
var propertyName = 'Property';
console.log(a['test' + propertyName]); // 10, bracket notation with dynamic property
```

æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹å¾ â€” å±æ€§è®¿é—®å™¨æ€»æ˜¯ä»å±æ€§è®¿é—®å™¨è°ƒç”¨ä½äºå·¦ä¾§çš„å¯¹è±¡çš„ `ToObject` è½¬æ¢ã€‚å¹¶ä¸”ç”±äºéšå¼è½¬æ¢ï¼Œå¯èƒ½è¢«ç²—ç³™çš„è¯´æˆâ€œJavaScriptä¸€åˆ‡çš†å¯¹è±¡â€ï¼ˆä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ—©å°±çŸ¥é“çš„ï¼Œå½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå› ä¸ºè¿˜æœ‰åŸå§‹çš„ä¸œè¥¿ï¼‰ã€‚

å¦‚æœæˆ‘ä»¬å°†å±æ€§è®¿é—®å™¨ä¸åŸå§‹å€¼ä¸€èµ·ä½¿ç”¨ï¼Œåªéœ€è¦åˆ›å»ºå…·æœ‰ç›¸åº”å€¼çš„ä¸­é—´åŒ…è£…å¯¹è±¡ã€‚å·¥ä½œå®Œæˆåï¼Œç§»é™¤è¿™ä¸ªåŒ…è£…å¯¹è±¡ã€‚

ğŸŒ°ï¼š

```jsx
var a = 10; // åŸå§‹å€¼
 
// ä½†æ˜¯å®ƒæœ‰æ–¹æ³•ï¼Œå°±åƒä»–æ˜¯ä¸€ä¸ªå¯¹è±¡
console.log(a.toString()); // "10"
 
// moreover, we can even
// (try) to create a new
// property in the "Ğ°" primitive calling [[Put]]
// è€Œä¸”ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°è¯•åœ¨aä¸Šåˆ›å»ºä¸€ä¸ªæ–°å±æ€§ï¼Œè°ƒç”¨äº†åŸå§‹çš„ [[Put]]
a.test = 100; // æ²¡æœ‰æŠ¥é”™ï¼Œè¿™ä¸ªç”Ÿæ•ˆäº†
 
// ä½†æ˜¯ï¼Œ [[Get]] æ–¹æ³•æ²¡æœ‰è¿”å›è¿™ä¸ªå±æ€§å€¼ï¼Œè€Œæ˜¯è¿”å›äº† undefined
console.log(a.test); // undefined
```

æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŸå§‹å€¼ `a` å¯ä»¥è®¿é—® `toString` æ–¹æ³•ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®æ–°åˆ›å»ºçš„ `test` å±æ€§å‘¢ï¼Ÿ

ç­”æ¡ˆå¾ˆç®€å•ï¼š

é¦–å…ˆï¼Œæ­£å¦‚æˆ‘ä»¬è¯´çš„ï¼Œåº”ç”¨å±æ€§è®¿é—®å™¨åï¼Œå°±ä¸å†æ˜¯åŸå§‹çš„ï¼Œè€Œæ˜¯ä¸­é—´å¯¹è±¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ *new Number(a)* ä½¿ç”¨äº†ï¼Œé€šè¿‡ç®—æ³•æ‰¾åˆ°äº†ä½œç”¨åŸŸé“¾ä¸­çš„ `toString` æ–¹æ³•ã€‚

```jsx
// è®¡ç®— a.toString() çš„ç®—æ³•
 
1. wrapper = new Number(a);
2. wrapper.toString(); // "10"
3. delete wrapper;
```

æ¥ä¸‹æ¥ï¼Œå½“è®¡ç®— `test` å±æ€§çš„æ—¶å€™ï¼Œ `[[Put]]` æ–¹æ³•ä¹Ÿä¼šåˆ›å»ºè‡ªå·±çš„ä¸­é—´å¯¹è±¡ï¼š

```jsx
 // è®¡ç®— a.test = 100 çš„ç®—æ³•
 
1. wrapper = new Number(a);
2. wrapper.test = 100;
3. delete wrapper;
```

æˆ‘ä»¬çœ‹åˆ°åœ¨ç¬¬ä¸‰æ­¥ä¸­ä¸­é—´å¯¹è±¡æ˜¯è¢«åˆ é™¤äº†ï¼ŒåŒæ—¶æ–°åˆ›å»ºçš„ `test` å¯¹è±¡å½“ç„¶ä¼šéšç€å¯¹è±¡çš„ç§»é™¤è€Œç§»é™¤ã€‚

æ¥ç€ï¼Œè°ƒç”¨ `[[Get]]` æ–¹æ³•ï¼Œå…¶ä¸­å±æ€§è®¿é—®å™¨å†æ¬¡åˆ›å»ºæ–°çš„åŒ…è£…å¯¹è±¡ï¼Œè¯¥åŒ…è£…å¯¹è±¡å½“ç„¶å¯¹ä»»ä½• `test` å±æ€§éƒ½ä¸çŸ¥é“ï¼š

```jsx
// è®¡ç®— a.test çš„ç®—æ³•
 
1. wrapper = new Number(a);
2. wrapper.test; // undefined
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œä»åŸè¯­å€¼å¼•ç”¨å±æ€§/æ–¹æ³•åªå¯¹è¯»å–å±æ€§æœ‰æ„ä¹‰ã€‚å¦å¤–ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªåŸå§‹å€¼ç»å¸¸ä½¿ç”¨å¯¹å±æ€§çš„è®¿é—®ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´èµ„æºï¼Œæœ‰ä¸€ç§ç›´æ¥ç”¨å¯¹è±¡è¡¨ç¤ºæ›¿æ¢å®ƒçš„æ„Ÿè§‰ã€‚ç›¸åï¼Œå¦‚æœå€¼åªå‚ä¸ä¸€äº›ä¸è¦æ±‚è®¿é—®å±æ€§çš„å°è®¡ç®—ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´æœ‰æ•ˆçš„åŸå§‹å€¼ã€‚

### ç»§æ‰¿

ä¼—æ‰€å‘¨çŸ¥ï¼ŒECMAScriptä½¿ç”¨åŸºäºåŸå‹çš„å§”æ‰˜ç»§æ‰¿ã€‚

é“¾æ¥ï¼ŒåŸå‹ç”Ÿæˆæ—¶å·²ç»æåˆ°çš„åŸå‹é“¾ã€‚

å®é™…ä¸Šï¼Œæ‰€æœ‰ç”¨åŸŸå®ç°å§”æ‰˜å’ŒåŸå‹é“¾åˆ†æçš„å·¥ä½œéƒ½ç®€åŒ–ä¸ºä¸Šè¿°çš„ `[[Get]]` æ–¹æ³•çš„å·¥ä½œã€‚

å¦‚æœä½ å®Œå…¨ç†è§£äº† `[[Get]]` æ–¹æ³•çš„ç®€å•ç®—æ³•ï¼ŒJavascriptä¸­ç»§æ‰¿çš„é—®é¢˜å°†ä¼šè‡ªå·±æ¶ˆå¤±ï¼Œå¹¶ä¸”ç­”æ¡ˆå°†ä¼šå¾ˆæ¸…æ™°æ˜äº†ã€‚

é€šå¸¸åœ¨è®ºå›ä¸Šå½“è°ˆåŠå…³äºJavaScriptçš„ç»§æ‰¿çš„æ—¶å€™ï¼Œæˆ‘åªå±•ç¤ºä¸€è¡ŒECMAScriptä»£ç çš„ä¾‹å­ï¼Œéå¸¸ç²¾å‡†æ˜ç¡®çš„æè¿°äº†è¿™é—¨è¯­è¨€å¯¹è±¡çš„ç»“æ„ï¼Œå¹¶ä¸”å±•ç¤ºäº†åŸºäºåŸå‹çš„å§”æ‰˜ã€‚çš„ç¡®ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºä»»ä½•æ„é€ å‡½æ•°æˆ–è€…å¯¹è±¡ï¼Œæ•´ä¸ªè¯­è¨€éƒ½å·²ç»ç»§æ‰¿äº†ã€‚è¿™è¡Œä»£ç éå¸¸ç®€å•ï¼š

```jsx
console.log(1..toString()); // "1"
```

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº† `[[Get]]` æ–¹æ³•å’Œå±æ€§è®¿é—®å™¨çš„ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼š

1. é¦–å…ˆï¼Œå› ä¸ºåŸå§‹å€¼ `1` ï¼Œ `new Number(1)` ä½œä¸ºä¸­é—´å¯¹è±¡è¢«åˆ›å»ºäº†ï¼›
2. æ¥ç€*ç»§æ‰¿çš„* `toString` æ–¹æ³•ä»ä¸­é—´å¯¹è±¡è°ƒç”¨ã€‚

ä¸ºä»€ä¹ˆæ˜¯ç»§æ‰¿çš„ï¼Ÿå› ä¸ºECMASCriptä¸­å¯¹è±¡æœ‰è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”åˆ›å»ºçš„ä¸­é—´å¯¹è±¡ï¼Œåœ¨è¿™é‡Œæ²¡æœ‰è‡ªå·±çš„ `toString` æ–¹æ³•ã€‚å› æ­¤ï¼Œå®ƒä»åŸå‹ä¸Šç»§æ‰¿ï¼Œå³ `Number.prototype` ã€‚

**æ³¨æ„è¯­æ³•çš„å¾®å¦™æƒ…å†µã€‚ä¸Šé¢ä¾‹å­ä¸­çš„ä¸¤ä¸ªç‚¹ä¸æ˜¯é”™è¯¯ï¼Œç¬¬ä¸€ä¸ªç‚¹ç”¨äºæ•°å­—çš„å°æ•°éƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªç‚¹æ˜¯å±æ€§è®¿é—®å™¨**ï¼š

```jsx
1.toString(); // SyntaxError!
 
(1).toString(); // OK
 
1 .toString(); // OK (space after 1)
 
1..toString(); // OK
 
1['toString'](); // OK
```

### åŸå‹é“¾

æˆ‘ä»¬æ¥å±•ç¤ºå¦‚ä½•ä¸ºç”¨æˆ·å®šä¹‰çš„å¯¹è±¡åˆ›å»ºä½œç”¨åŸŸé“¾ã€‚ç›¸å½“ç®€å•ï¼š

```jsx
function A() {
  console.log('A.[[Call]] activated');
  this.x = 10;
}
A.prototype.y = 20;
 
var a = new A();
console.log([a.x, a.y]); // 10 (own), 20 (inherited)
 
function B() {}
 
// the easiest variant of prototypes
// chaining is setting child
// prototype to new object created,
// by the parent constructor
B.prototype = new A();
 
// fix .constructor property, else it would be Ğ
B.prototype.constructor = B;
 
var b = new B();
console.log([b.x, b.y]); // 10, 20, both are inherited
 
// [[Get]] b.x:
// b.x (no) -->
// b.[[Prototype]].x (yes) - 10
 
// [[Get]] b.y
// b.y (no) -->
// b.[[Prototype]].y (no) -->
// b.[[Prototype]].[[Prototype]].y (yes) - 20
 
// where b.[[Prototype]] === B.prototype,
// and b.[[Prototype]].[[Prototype]] === A.prototype
```

æ­¤æ–¹æ³•å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ã€‚

ç¬¬ä¸€ï¼Œ `B.prototype` å°†ä¼šåŒ…å« `x` å±æ€§ã€‚ä¹ä¸€çœ‹ï¼Œåƒæ˜¯ä¸æ­£ç¡®ï¼Œå› ä¸º `x` å±æ€§æ˜¯ä½œä¸º `A` è‡ªèº«å±æ€§å®šä¹‰ï¼Œå¹¶é¢„æœŸåœ¨ `B` æ„é€ å‡½æ•°å¯¹è±¡ä¸­ä¹Ÿæ˜¯è‡ªå·±çš„ã€‚

åœ¨åŸå‹ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ­£ç¡®æƒ…å†µï¼Œå› ä¸ºåä»£å¯¹è±¡å¦‚æœæ²¡æœ‰è¿™æ ·å±äºè‡ªå·±çš„å±æ€§ï¼Œå°†ä¼šå§”æ‰˜ç»™åŸå‹ã€‚èƒŒåçš„æƒ³æ³•æ˜¯ï¼Œç”± `B` æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ä¸éœ€è¦ `x` å±æ€§ã€‚ç›¸åï¼Œåœ¨åŸºäºç±»æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½å¤åˆ¶åˆ°ç±»åä»£ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä»ç„¶éœ€è¦ï¼ˆæ¨¡æ‹ŸåŸºäºç±»çš„æ–¹æ³•ï¼‰ç”± `B` æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡æ‹¥æœ‰ `x` å±æ€§ï¼Œåˆ™å¯¹æ­¤æœ‰ä¸€äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢æ˜¾ç¤ºå…¶ä¸­ä¸€ç§æ–¹æ³•ã€‚

ç¬¬äºŒï¼Œè¿™å·²ç»ä¸æ˜¯åŠŸèƒ½è€Œæ˜¯ç¼ºç‚¹ï¼Œå½“åä»£åŸå‹è¢«åˆ›å»ºï¼Œæ„é€ å‡½æ•°çš„ä»£ç ä¹Ÿä¼šæ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° `A.[[Call]] activated` æ¶ˆæ¯æ˜¾ç¤ºäº†ä¸¤æ¬¡ï¼Œå½“ `A` æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡è¢«ç”¨äº `B.prototype` çš„æ—¶å€™ï¼Œä»¥åŠå¯¹è±¡åˆ›å»ºæ—¶ `a` å¯¹è±¡è‡ªèº«ã€‚

ä¸€ä¸ªæ›´å…³é”®çš„ä¾‹å­æ˜¯çˆ¶æ„é€ å‡½æ•°ä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼šå¯¹äºè¿™ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„å®é™…å¯¹è±¡ï¼Œå¯èƒ½éœ€è¦è¿™æ ·çš„æ£€æŸ¥ï¼Œä½†æ˜¾ç„¶ï¼Œä½¿ç”¨è¿™äº›çˆ¶å¯¹è±¡ä½œä¸ºåŸå‹æ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ï¼š

```jsx
function A(param) {
  if (!param) {
    throw 'Param required';
  }
  this.param = param;
}
A.prototype.x = 10;
 
var a = new A(20);
console.log([a.x, a.param]); // 10, 20
 
function B() {}
B.prototype = new A(); // Error
```

é™¤æ­¤ä¹‹å¤–ï¼Œçˆ¶çº§æ„é€ å‡½æ•°ä¸­çš„å¤§é‡è®¡ç®—å¯ä»¥è§†ä¸ºæ­¤æ–¹æ³•çš„ç¼ºç‚¹ã€‚

è¦è§£å†³è¿™äº›â€œç‰¹ç‚¹â€å’Œé—®é¢˜ï¼Œç°åœ¨çš„ç¨‹åºå‘˜ä½¿ç”¨æ ‡å‡†æ¨¡å¼æ¥è¿æ¥åŸå‹ï¼Œæˆ‘é¢ä¸‹é¢å°†çœ‹åˆ°çš„ã€‚è¿™ä¸ªæŠ€å·§çš„ä¸»è¦ç›®æ ‡æ˜¯åˆ›å»ºä¸­é—´åŒ…è£…å™¨æ„é€ å‡½æ•°ï¼Œé“¾æ¥æ‰€éœ€çš„åŸå‹ã€‚

```jsx
function A() {
  console.log('A.[[Call]] activated');
  this.x = 10;
}
A.prototype.y = 20;
 
var a = new A();
console.log([a.x, a.y]); // 10 (own), 20 (inherited)
 
function B() {
  // or simply A.apply(this, arguments)
  B.superproto.constructor.apply(this, arguments);
}
 
// inheritance: chaining prototypes
// via creating empty intermediate constructor
var F = function () {};
F.prototype = A.prototype; // reference
B.prototype = new F();
B.superproto = A.prototype; // explicit reference to ancestor prototype, "sugar"
 
// fix .constructor property, else it would be A
B.prototype.constructor = B;
 
var b = new B();
console.log([b.x, b.y]); // 10 (own), 20 (inherited)
```

æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ `b` å®ä¾‹ä¸Šåˆ›å»ºè‡ªå·±çš„ `x` å±æ€§çš„ï¼šåœ¨æ–°åˆ›å»ºå¯¹è±¡çš„ä¸Šé¢æˆ‘ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `B.superproto.constructor` å¼•ç”¨è°ƒç”¨çˆ¶çº§æ„é€ å‡½æ•°ã€‚

æˆ‘ä»¬ä¹Ÿä¿®å¤äº†æ— é¡»ä½¿ç”¨çˆ¶çº§æ„é€ å‡½æ•°æ¥åˆ›å»ºåä»£åŸå‹çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œå½“éœ€è¦çš„æ—¶å€™ï¼Œ `"A.[[Call]].activated"` æ¶ˆæ¯ä¼šæ˜¾ç¤ºã€‚

è€Œä¸”ä¸è¦æ¯æ¬¡éƒ½é‡å¤åŸå‹é“¾çš„ç›¸åŒæ“ä½œï¼ˆåˆ›å»ºä¸­é—´æ„é€ å™¨ï¼Œè®¾ç½® `superproto` ç³–ï¼Œæ¢å¤åŸæ¥çš„ `constructor` ç­‰ï¼‰ï¼Œè¿™ä¸ªæ¨¡æ¿å¯ä»¥å°è£…åœ¨æ–¹ä¾¿çš„å·¥å…·å‡½æ•°ä¸­ï¼Œä¸ç®¡æ„é€ å‡½æ•°çš„åå­—æ˜¯ä»€ä¹ˆï¼Œç›®çš„éƒ½æ˜¯é“¾æ¥åŸå‹ï¼š

```jsx
function inherit(child, parent) {
  var F = function () {};
  F.prototype = parent.prototype
  child.prototype = new F();
  child.prototype.constructor = child;
  child.superproto = parent.prototype;
  return child;
}
```

ç›¸åº”çš„ï¼Œç»§æ‰¿ï¼š

```jsx
function A() {}
A.prototype.x = 10;
 
function B() {}
inherit(B, A); // chaining prototypes
 
var b = new B();
console.log(b.x); // 10, found in the A.prototype
```

è¿™ç§åŒ…è£…æœ‰å¾ˆå¤šå˜ç§ï¼ˆå…³äºè¯­æ³•æ–¹é¢ï¼‰ï¼Œä½†æ˜¯ï¼Œæ‰€æœ‰è¿™äº›éƒ½ç®€åŒ–ä¸ºä¸Šè¿°æè¿°ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸­é—´æ„é€ å‡½æ•°æ”¾åœ¨å¤–é¢ï¼ˆå› æ­¤ï¼Œåªæœ‰ä¸€ä¸ªå‡½æ•°ä¼šè¢«åˆ›å»ºï¼‰ï¼Œ å¯ä»¥ä¼˜åŒ–ä¹‹å‰çš„åŒ…è£…ï¼Œä»è€Œé‡ç”¨ä¹‹å‰çš„ï¼š

```jsx
var inherit = (function(){
  function F() {}
  return function (child, parent) {
    F.prototype = parent.prototype;
    child.prototype = new F;
    child.prototype.constructor = child;
    child.superproto = parent.prototype;
    return child;
  };
})();
```

å› ä¸ºå¯¹è±¡çš„çœŸå®çš„åŸå‹æ˜¯ `[[Prototype]]` å±æ€§ï¼Œè¿™æ„å‘³ç€ `F.prototype` å¯ä»¥è¢«è½»æ˜“çš„ä¿®æ”¹ä¸é‡ç”¨ï¼Œå› ä¸ºé€šè¿‡ `new F` åˆ›å»ºçš„ `child.prototype` å°†ä¼šä» `child.prototype` çš„å½“å‰å€¼è·å¾—ä»–çš„ `[[Prototype]]` ã€‚

```jsx
function A() {}
A.prototype.x = 10;
 
function B() {}
inherit(B, A);
 
B.prototype.y = 20;
 
B.prototype.foo = function () {
  console.log("B#foo");
};
 
var b = new B();
console.log(b.x); // 10, is found in A.prototype
 
function C() {}
inherit(C, B);
 
// and using our "superproto" sugar
// we can call parent method with the same name
 
C.prototype.foo = function () {
  C.superproto.foo.call(this);
  console.log("C#foo");
};
 
var c = new C();
console.log([c.x, c.y]); // 10, 20
 
c.foo(); // B#foo, C#foo
```

æ³¨æ„ï¼ŒES5æ ‡å‡†åŒ–äº†è¿™ä¸ªå·¥å…·å‡½æ•°ï¼Œä»¥å®ç°æ›´å¥½çš„é“¾æ¥ã€‚å®ƒå°±æ˜¯ `Object.create` æ–¹æ³•ã€‚

ES3ä¸­çš„ç®€åŒ–ç‰ˆæœ¬å‡ ä¹å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

```jsx
Object.create ||
Object.create = function (parent, properties) {
  function F() {}
  F.prototype = parent;
  var child = new F;
  for (var k in properties) {
    child[k] = properties[k].value;
  }
  return child;
```

ä½¿ç”¨ï¼š

```jsx
var foo = {x: 10};
var bar = Object.create(foo, {y: {value: 20}});
console.log(bar.x, bar.y); // 10, 20
```

å…³äºè¯¦æƒ…æŸ¥çœ‹[è¿™ç¯‡æ–‡ç« ](http://dmitrysoshnikov.com/ecmascript/es5-chapter-1-properties-and-property-descriptors/)ã€‚

åŒæ ·ï¼Œâ€œJSä¸­çš„ç»å…¸ç»§æ‰¿â€çš„ç°æœ‰çš„æ‰€æœ‰æ¨¡ä»¿å½¢å¼éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸç†ã€‚ç°åœ¨æˆ‘ä»¬çœ‹åˆ°ï¼Œå®é™…ä¸Šå®ƒç”šè‡³ä¸æ˜¯ä¸€ä¸ªâ€œåŸºäºæ¨¡ä»¿ç±»çš„ç»§æ‰¿â€ï¼Œè€Œåªæ˜¯åŸå‹é“¾ç®€å•çš„ä»£ç é‡ç”¨ã€‚

æ³¨æ„ï¼šåœ¨ES6ä¸­â€œclassâ€çš„æ¦‚å¿µæ ‡å‡†åŒ–äº†ï¼Œå¹¶è¢«å®ç°ä¸ºå¦‚ä¸Šæ‰€è¿°çš„æ„é€ å‡½æ•°ä¹‹ä¸Šçš„è¯­æ³•ç³–ã€‚ä»è¿™ç‚¹å‡ºå‘ï¼ŒåŸå‹é“¾å˜æˆäº†åŸºäºç±»ç»§æ‰¿çš„å®ç°ï¼š

```jsx
// ES6
class Foo {
  constructor(name) {
    this._name = name;
  }
 
  getName() {
    return this._name;
  }
}
 
class Bar extends Foo {
  getName() {
    return super.getName() + ' Doe';
  }
}
 
var bar = new Bar('John');
console.log(bar.getName()); // John Doe
```

â€‹![å…³æ³¨å…¬ä¼—å·](../img/wechat.png)